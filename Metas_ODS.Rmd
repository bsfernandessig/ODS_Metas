---
title: "Acompanhamento das metas dos ODS"
output:
  html_document:
    toc: true
    toc_depth: 4 
    toc_float:
      collapsed: true
      smooth_scroll: true
    theme: flatly 
    pandoc_args: ["--lua-filter", "tabset.lua"] 

---


```{r setup, include=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
               cache=FALSE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

```{=html}
<script src='tabset.js'></script>
```

```{r Pacotes, message=FALSE, warning=FALSE, include=FALSE}
#pacotes

#install.packages(c("ggthemes", "ggpubr", "readr", "readxl", "rstatix", "sp", "sf", "tmap", "leaflet", "arsenal", "knitr", "plotly", "kableExtra", "prettydoc", "rmdformats", "knitr", "scales", "esquisse", "pacman"))

#install.packages(c(	"broom", "cli", "crayon" , "dbplyr", "dplyr", "forcats", "ggplot2", "haven", "hms", "httr", "jsonlite", "lubridate", "magrittr", "modelr", "pillar", "purrr", "readr", "readxl", "reprex", "rlang", "rstudioapi", "rvest", "stringr", "tibble", "tidyr", "xml2", "BAMMtools"))

##install.packages("factoextra")
##install.packages("qwraps2")

pacman::p_load(ggthemes, ggpubr, tidyverse, readr, readxl, esquisse, rstatix, sp, sf, tmap, leaflet, arsenal, knitr, plotly, kableExtra, prettydoc, rmdformats, knitr, scales, broom, cli, crayon , dbplyr, dplyr, forcats, ggplot2, haven, hms, httr, jsonlite, lubridate, magrittr, modelr, pillar, purrr, readr, readxl, reprex, rlang, rstudioapi, rvest, stringr, tibble, tidyr, xml2, factoextra, qwraps2, BAMMtools) 



options(scipen=999)

```

```{r Shapes, message=FALSE, warning=FALSE, include=FALSE}

SHP_Municipios <- read_sf("data/shapes/BR_Municipios_2020_simplif.shp")
SHP_Estados <- read_sf("data/shapes/estados_2010_simplif.shp")

st_crs(SHP_Municipios)
tmap_mode("plot")

# tmap_mode("plot") #> tmap mode set to plotting

# Mudando o nome pra ficar igual ao da tabela
names(SHP_Municipios)[1] <- "COD"


# A ser usado na hora de gerar o mapa
margens <- list(b = 50, t = 115)

# # make some bbox magic
 bbox_new <- st_bbox(SHP_Municipios) # current bounding box
# 
 xrange <- bbox_new$xmax - bbox_new$xmin # range of x values
 yrange <- bbox_new$ymax - bbox_new$ymin # range of y values
# 
  bbox_new[1] <- bbox_new[1] - (0.12 * xrange) # xmin - left
#  bbox_new[3] <- bbox_new[3] + (0.1 * xrange) # xmax - right (aumenta a direita)
#  bbox_new[2] <- bbox_new[2] - (0.50 * yrange) # ymin - bottom
# #bbox_new[4] <- bbox_new[4] + (0.1 * yrange) # ymax - top (aumenta em cima)
# 
 bbox_new <- bbox_new %>%  # take the bounding box ...
   st_as_sfc() # ... and make it a sf polygon

```

# Introdução

<br>

## Sobre a classificação dos dados

Para definir se uma variável está próxima ou não de atingir um objetivo, é necessário definir como será calculada cada quebra. Tanto quando há a definição clara de qual valor define um objetivo como atingido, quanto quando o objetivo atingido equivale a completude de um processo (0% ou 100%, a depender do dado utilizado), é necessário apontar onde serão os cortes de valores dentre os municípios que não fazem parte do grupo que cumpriu a meta. Portanto, para dizer se um município está mais próximo ou mais distante de uma meta, intervalos de valores que definam o que é próximo e o que é distante precisam ser atribuídos. 

Apesar de existirem diversas formas de realizar essa classificação, aqui serão mencionadas quatro, bem como a justificativa para escolha de uma delas para o trabalho:

* Quebras manuais: Uma primeira opção seria definir manualmente os quatro intervalos (de mais próximo a mais distante de atingir uma meta ODS). Apesar de ser o método que permite a maior flexibilidade para fazer com que o dado apresente as classificações como se deseja, o problema de se utilizar desse tipo de classificação nesse trabalho é que, uma vez que não há formalmente definido valores que ditam no consiste um município mais próximo e no que consiste um mais distante de uma meta, defini-las manualmente torna a classificação extremamente arbitrária, sem necessariamente um rigor sobre o motivo de um corte ser em x e não y.

* Intervalos iguais: Uma segunda opção seria definir intervalos iguais entre as classes. Esse é um método que melhor se adequa a intervalos de dados conhecidos (como porcentagens) e que estão distribuídos homogeneamente. Também não se mostra ideal no caso das variáveis relacionadas às metas dos ODS porque, na grande maioria dos casos, os dados se distribuem de forma bastante heterogênea, por vezes estando concentrados majoritariamente em um intervalo específico, fazendo com que pouca ou nenhuma informação esteja presente nas demais classes.

* Quantis: Nesse tipo de classificação as classes apresentam um número igual de feições, não gerando nenhuma classe vazia ou classes com valores muito distintos entre si. Assim como usado no relatório de referência de *L.F. NOVAIS CONSULTORES LTDA*, os método de quantis é eficiente para compreender, considerando todo o conjunto dos dados, qual o grupo de municípios que está mais próximo ou mais distante de um valor de referência; ao analisar em vários momentos o quinto quintil dos dados, supondo que há 100 municípios na análise, o foco está localizado nos 20 municípios com valores mais extremos. Ao mesmo tempo em que essa pode ser uma boa medida para utilizar nos indicadores analisados, uma vez que ela evidencia com clareza qual o conjunto de municípios mais próximos e mais distantes da meta, os cortes feitos pelo método podem ser problemáticos para análises. Pelo fato das feições serem agrupadas em números iguais em cada uma das classes, os resultados podem ser por vezes enganosos quando os valores não estão distribuídos uniformemente; ao considerar como corte apenas o número de observações e não o valor de cada observação, classes diferentes podem possuir valores muito próximos entre si ou ainda, uma mesma classe pode incorporar municípios com valores extremamente distintos. 
  + Um exemplo que ajuda a ilustrar a problemática da utilização dos quantis: Dados de 100 municípios, com uma variável contendo valores de 0 a 100 **uniformemente** distribuídos, ao serem divididos em quartis (quatro classes), ficariam com cortes de 0 a 25 (com 20 municípios), de 25 a 50 (com 20 municípios), 50 a 75 (com 20 municípios) e de 75 a 100 (com 20 municípios), totalizando 100 municípios. No caso desses municípios possuírem uma **distribuição heterogênea**, por exemplo com muitos municípios com valores mais próximos de 0, a distribuição poderia ficar com cortes de 0 a 5 (com 20 municípios), de 5 a 12 (com 20 municípios), de 12 a 20 (com 20 municípios) e de 20 a 100 (com 20 municípios). 
 
* Quebras Naturais (Jenks): Por fim, a classificação por quebras naturais (algoritmo de Jenks ou Fisher) é baseada nos agrupamentos naturais inerentes aos dados, ou seja, as quebras são dadas a partir de agrupamentos de valores semelhantes, maximizando as diferenças entre classes, o que confere maior precisão à distribuição espacial dos dados e fornece um melhor suporte ao mapeamento de valores que não estão uniformemente distribuídos. Esse método de classificação é o escolhido para a análise porque, dados os pontos já mencionados, dentre os métodos mais utilizados é o de quebras naturais que parece melhor sustentar a análise do cumprimento dos ODS a partir da divisão dos municípios entre quatro classes (de mais próximo a mais distante da meta).

<br>

Dado a escolha da classificação, é necessário definir quantas e quais serão as classes. No caso da meta possuir um valor claro para definir se ela foi atingida (por ex.: menos de 3%, menos de 5 por mil nascidos vivos), a primeira categoria consiste nos municípios dentro dessa meta e, as demais categorias, consistem na separação dos dados em quatro categorias, classificadas pelo método de quebras naturais. No caso da meta não apresentar um valor objetivo definido para o seu cumprimento, houveram duas possibilidades: quando os valores estão relacionados a uma escala conhecida (como porcentagem), os municípios que apresentaram valores de atendimento perfeito à meta foram classificados como municipios que atingiram aquela meta (por exemplo, municípios com 100% de abastecimento de água).

Portanto, as classificações apresentam as seguintes categorias:
  + Municípios que atingiram a meta 
  + Municípios muito próximos de atingir a meta
  + Municípios próximos de atingir a meta
  + Municípios distantes de atingir a meta
  + Municípios muito distantes de atingir a meta
  

<br>

  
## Ano dos dados

Foram considerados, para todos os indicadores disponibilizados, o ano mais recente presente nas tabelas de dados, sendo este normalmente 2016, 2017 ou 2018. O ano utilizado está indicado na descrição de cada ODS.

<br>

## Sobre a estrutura do documento

Quando a meta definida inicialmente pela ONU teve seus valores redesenhados pelo IBGE/IPEA para melhor se adaptar à realidade do país, o documento se subdivide em duas categorias, uma tratando da meta original da ONU e, outra, tratando da meta brasileira.

<br>
<br>

------

<br>
<br>

# ODS 1 - Erradicação da pobreza

**ODS 1: Acabar com a pobreza em todas as suas formas, em todos os lugares**

```{r ODS1_Tabelas, message=FALSE, warning=FALSE, include=FALSE}

ODS1_1 <- read_excel("data/ODS_Bases_consolidadas/ODS1_Indicador_111_112_prop_pobres_MUN_CENSO_PNAD_00_10_17.xlsx", 
    col_types = c("text", "text", "text", 
        "text", "text", "numeric", "text", 
        "text", "text", "text", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric")) %>%
  mutate(REGIAO = case_when(uf == "AC" ~ "Norte",
                            uf == "AP" ~ "Norte",
                            uf == "AM" ~ "Norte",
                            uf == "PA" ~ "Norte",
                            uf == "RO" ~ "Norte",
                            uf == "RR" ~ "Norte",
                            uf == "TO" ~ "Norte",
                            
                            uf == "AL" ~ "Nordeste",
                            uf == "BA" ~ "Nordeste",
                            uf == "CE" ~ "Nordeste",
                            uf == "MA" ~ "Nordeste",
                            uf == "PB" ~ "Nordeste",
                            uf == "PI" ~ "Nordeste",
                            uf == "PE" ~ "Nordeste",
                            uf == "RN" ~ "Nordeste",
                            uf == "SE" ~ "Nordeste",
                            
                            uf == "DF" ~ "Centro-Oeste",
                            uf == "GO" ~ "Centro-Oeste",
                            uf == "MT" ~ "Centro-Oeste",
                            uf == "MS" ~ "Centro-Oeste",
                            
                            uf == "ES" ~ "Sudeste",
                            uf == "MG" ~ "Sudeste",
                            uf == "RJ" ~ "Sudeste",
                            uf == "SP" ~ "Sudeste",
                            
                            uf == "PR" ~ "Sul",
                            uf == "RS" ~ "Sul",
                            uf == "SC" ~ "Sul"))

names(ODS1_1)[1] <- "COD"

```

```{r ODS1_CalculoCategorias, message=FALSE, warning=FALSE, include=FALSE}

ODS1_1_CORTES <- 
  ODS1_1 %>% 
  summarise(pobrExt_ONU17_QUARTIL = quantile(ODS1_1[ODS1_1$p_pes_pobr_ext_ONU_2017 > 3,]$`p_pes_pobr_ext_ONU_2017`, c(0, 0.25, 0.5, 0.75, 1)), 
            pobrExt_IBGE17_QUARTIL = quantile(ODS1_1[ODS1_1$p_pes_pobr_ext_IBGE_2017 > 3,]$`p_pes_pobr_ext_IBGE_2017`, c(0, 0.25, 0.5, 0.75, 1)),
            pobrExt_ONU17_JENKS = BAMMtools::getJenksBreaks(ODS1_1[ODS1_1$p_pes_pobr_ext_ONU_2017 > 3,]$`p_pes_pobr_ext_ONU_2017`, 5),
            pobrExt_IBGE17_JENKS = BAMMtools::getJenksBreaks(ODS1_1[ODS1_1$p_pes_pobr_ext_IBGE_2017 > 3,]$`p_pes_pobr_ext_IBGE_2017`, 5) 
            )
            
            #pobr_ext_IBGE2017_5 = BAMMtools::getJenksBreaks(ODS1_1[ODS1_1$p_pes_pobr_ext_ONU_2017 > 3,]$`p_pes_pobr_ext_ONU_2017`, 5)
            
            #contagem = count(ODS1_1$p_pes_pobr_ext_ONU_2017 > 50)
            
            
  

ODS1_1_Jenks <- as.data.frame(BAMMtools::getJenksBreaks(ODS1_1[ODS1_1$p_pes_pobr_ext_ONU_2017 > 3,]$`p_pes_pobr_ext_ONU_2017`, 5))
ODS1_1_Jenks <- bind_cols(ODS1_1_Jenks, as.data.frame(BAMMtools::getJenksBreaks(ODS1_1[ODS1_1$p_pes_pobr_ext_IBGE_2017 > 3,]$`p_pes_pobr_ext_IBGE_2017`, 5)))


ODS1_1_final <- ODS1_1 %>%
  mutate(PobExtrONU_2017 = 
           case_when(p_pes_pobr_ext_ONU_2017 <= 3 ~ "Meta ODS atingida",
                     p_pes_pobr_ext_ONU_2017 > 3 & p_pes_pobr_ext_ONU_2017 <= ODS1_1_CORTES[2,]$pobrExt_ONU17_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     p_pes_pobr_ext_ONU_2017 > ODS1_1_CORTES[2,]$pobrExt_ONU17_JENKS & p_pes_pobr_ext_ONU_2017 <= ODS1_1_CORTES[3,]$pobrExt_ONU17_JENKS ~ "Meta ODS próxima de ser atingida",
                     p_pes_pobr_ext_ONU_2017 > ODS1_1_CORTES[3,]$pobrExt_ONU17_JENKS & p_pes_pobr_ext_ONU_2017 <= ODS1_1_CORTES[4,]$pobrExt_ONU17_JENKS ~ "Meta ODS distante de ser atingida",
                     p_pes_pobr_ext_ONU_2017 > ODS1_1_CORTES[4,]$pobrExt_ONU17_JENKS & p_pes_pobr_ext_ONU_2017 <= ODS1_1_CORTES[5,]$pobrExt_ONU17_JENKS ~ "Meta ODS muito distante de ser atingida"
                     
                     ),
         
         PobExtrIBGE_2017 =
           (case_when(p_pes_pobr_ext_IBGE_2017 <= 3 ~ "Meta ODS atingida",
                                    p_pes_pobr_ext_IBGE_2017 > 3 & p_pes_pobr_ext_IBGE_2017 <= ODS1_1_CORTES[2,]$pobrExt_IBGE17_JENKS ~ "Meta ODS muito próxima de ser atingida",
                                    p_pes_pobr_ext_IBGE_2017 > ODS1_1_CORTES[2,]$pobrExt_IBGE17_JENKS & p_pes_pobr_ext_IBGE_2017 <= ODS1_1_CORTES[3,]$pobrExt_IBGE17_JENKS ~ "Meta ODS próxima de ser atingida",
                                    p_pes_pobr_ext_IBGE_2017 > ODS1_1_CORTES[3,]$pobrExt_IBGE17_JENKS & p_pes_pobr_ext_IBGE_2017 <= ODS1_1_CORTES[4,]$pobrExt_IBGE17_JENKS ~ "Meta ODS distante de ser atingida",
                                    p_pes_pobr_ext_IBGE_2017 > ODS1_1_CORTES[4,]$pobrExt_IBGE17_JENKS & p_pes_pobr_ext_IBGE_2017 <= ODS1_1_CORTES[5,]$pobrExt_IBGE17_JENKS ~ "Meta ODS muito distante de ser atingida")
                     )
  )
      


ODS1_1_final$PobExtrONU_2017 <- factor(ODS1_1_final$PobExtrONU_2017, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))

ODS1_1_final$PobExtrIBGE_2017 <- factor(ODS1_1_final$PobExtrIBGE_2017, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))



ODS1_1_SUMARIOgeral <- ODS1_1_final %>%
  group_by(`Bioma 1`, `Tipologia Veiga (2002)`, PobExtrIBGE_2017, PobExtrONU_2017) %>%
  summarise(contagem = n())
```

```{r ODS1_1_JOIN SHP, message=FALSE, warning=FALSE, include=FALSE}
# Juntando o shape e a tabela
SHP_Mun_join_1_1 <- SHP_Municipios %>%
  left_join(., ODS1_1_final, by = "COD")

```


O primeiro ODS, associado à erradicação da pobreza, será analisado a partir da meta 1.1, com indicador que fornece a porcentagem de pessoas vivendo na pobreza extrema no ano de 2017.

* Meta 1.1:
  + **ONU:** Até 2030, erradicar a pobreza extrema para todas as pessoas em todos os lugares, atualmente medida como pessoas vivendo com menos de US$ 1,25 por dia.
  + **IBGE/IPEA:** Até 2030, erradicar a pobreza extrema para todas as pessoas em todos os lugares, medida como pessoas vivendo com menos de PPC$ 3,20 per capita por dia.
  


O mapa abaixo mostra a distribuição espacial geral dos dados no Brasil:

```{r ODS1_1_MAPA_NEONATAL_GERAL, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS1_1_MAPA_GERAL_ONU <-
  SHP_Mun_join_1_1 %>%
  filter(!is.na(p_pes_pobr_ext_ONU_2017)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "p_pes_pobr_ext_ONU_2017", 
          title = "% de pessoas em pobreza extrema \n(menos de US$ 1,25 por dia)", 
          id = "nome", 
          palette=c("#5e4fa2", "#66c2a5", "#e6f598", "#fee08b", "#f46d43","#9e0142"),

          n=6,
          style = "fisher") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 1.1 (ONU): Pobreza extrema", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000)) 


ODS1_1_MAPA_GERAL_IBGE <-
  SHP_Mun_join_1_1 %>%
  filter(!is.na(p_pes_pobr_ext_IBGE_2017)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "p_pes_pobr_ext_IBGE_2017", 
          title = "% de pessoas em pobreza extrema \n(menos de PPC$ 3,20 per cap por dia)", 
          id = "nome", 
          palette=c("#5e4fa2", "#66c2a5", "#e6f598", "#fee08b", "#f46d43","#9e0142"),

          n=6,
          style = "fisher") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 1.1 (IBGE): Pobreza extrema", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000)) 



tmap_arrange(ODS1_1_MAPA_GERAL_ONU, ODS1_1_MAPA_GERAL_IBGE, 
             sync = TRUE, 
             nrow = 1)



```

<br>

Abaixo, a tabela apresenta as médias de valores por região do Brasil:


```{r ODS1_1 TabelaRegiao, echo=FALSE, message=FALSE, warning=FALSE}

ODS1_1 %>%
  group_by(REGIAO) %>%
  summarise(`% de pessoas em pobreza extrema (ONU)` = round(mean(p_pes_pobr_ext_ONU_2017), 2),
            `% de pessoas em pobreza extrema (IBGE)` = round(mean(p_pes_pobr_ext_IBGE_2017), 2)) %>%
  kbl(align = "ccc",
    caption = "ODS 1.1 (IBGE): Pobreza extrema") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) 

```



<br>

------

<br>


## Critérios ONU 


**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da ONU.

* Meta ODS atingida: Até 3% de população em pobreza extrema.
* Meta ODS muito próxima de ser atingida: De `r round(ODS1_1_CORTES[1,]$pobrExt_ONU17_JENKS, 2)`% a `r round(ODS1_1_CORTES[2,]$pobrExt_ONU17_JENKS, 2)`%.
* Meta ODS próxima de ser atingida: De `r round(ODS1_1_CORTES[2,]$pobrExt_ONU17_JENKS, 2)`% a `r round(ODS1_1_CORTES[3,]$pobrExt_ONU17_JENKS, 2)`%.
* Meta ODS distante de ser atingida: De `r round(ODS1_1_CORTES[3,]$pobrExt_ONU17_JENKS, 2)`% a `r round(ODS1_1_CORTES[4,]$pobrExt_ONU17_JENKS, 2)`%.
* Meta ODS muito distante de ser atingida: De `r round(ODS1_1_CORTES[4,]$pobrExt_ONU17_JENKS, 2)`% a `r round(ODS1_1_CORTES[5,]$pobrExt_ONU17_JENKS, 2)`%.


**Resumo por região**

```{r ODS1_1 TabelaRegiao_ONU_neo, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")

ODS1_1_final %>%
  count(REGIAO = factor(REGIAO), PobExtrONU_2017 = factor(PobExtrONU_2017)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = PobExtrONU_2017,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 1.1 (ONU) - Pobreza extrema (2017)") %>%
  
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2)) %>%
  
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```

**Distribuição espacial**

```{r ODS1_1_MAPA_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS1_1_MAPA_ONU <- 
  SHP_Mun_join_1_1 %>%
  filter(!is.na(PobExtrONU_2017)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "PobExtrONU_2017", 
         title = "ODS 1.1: % da pop em pobreza extrema (ONU)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS Meta 1.1 (ONU) - Pobreza extrema (2017)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  

ODS1_1_MAPA_ONU

```



<br>

<br>



#### Resumo por biomas

```{r ODS1_1_Tabela_Biomas__ONU, echo=FALSE, message=FALSE, warning=FALSE}

ODS1_1_SUMARIObioma_IBGE <- ODS1_1_final %>%
  group_by(`Bioma 1`, PobExtrIBGE_2017) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = PobExtrIBGE_2017, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS1_1_SUMARIObioma_IBGE <- ODS1_1_SUMARIObioma_IBGE[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")

ODS1_1_NEO_SUMARIObioma_ONU_kbl <- kbl(ODS1_1_SUMARIObioma_IBGE,
    col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 1.1 - Critérios ONU") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS1_1_NEO_SUMARIObioma_ONU_kbl

```


<br>

<br>


#### Resumo por tipologias


```{r ODS1_1_Tabela_Tipologia_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE}

ODS1_1_SUMARIOtipologia_ONU <- ODS1_1_final %>%
  group_by(`Tipologia Veiga (2002)`, PobExtrONU_2017) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = PobExtrONU_2017, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS1_1_SUMARIOtipologia_ONU <- ODS1_1_SUMARIOtipologia_ONU[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]

ODS1_1_SUMARIOtipologia_ONU$`Tipologia Veiga (2002)` <- factor(ODS1_1_SUMARIOtipologia_ONU$`Tipologia Veiga (2002)`, levels = c("Rural",
                                                                                                  "Intermediário",
                                                                                                  "Urbano"))
  
options(knitr.kable.NA = "Não há")


ODS1_1_SUMARIOtipologia_ONU <- kbl(ODS1_1_SUMARIOtipologia_ONU,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 1.1 - Critérios ONU") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS1_1_SUMARIOtipologia_ONU



```


<br>

------

<br>


## Critérios IBGE 


**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da IBGE.

* Meta ODS atingida: Até 3% de população em pobreza extrema.
* Meta ODS muito próxima de ser atingida: De `r round(ODS1_1_CORTES[1,]$pobrExt_IBGE17_JENKS, 2)`% a `r round(ODS1_1_CORTES[2,]$pobrExt_IBGE17_JENKS, 2)`%.
* Meta ODS próxima de ser atingida: De `r round(ODS1_1_CORTES[2,]$pobrExt_IBGE17_JENKS, 2)`% a `r round(ODS1_1_CORTES[3,]$pobrExt_IBGE17_JENKS, 2)`%.
* Meta ODS distante de ser atingida: De `r round(ODS1_1_CORTES[3,]$pobrExt_IBGE17_JENKS, 2)`% a `r round(ODS1_1_CORTES[4,]$pobrExt_IBGE17_JENKS, 2)`%.
* Meta ODS muito distante de ser atingida: De `r round(ODS1_1_CORTES[4,]$pobrExt_IBGE17_JENKS, 2)`% a `r round(ODS1_1_CORTES[5,]$pobrExt_IBGE17_JENKS, 2)`%.

<br>

**Resumo por região**

```{r ODS1_1 TabelaRegiao_IBGE_neo, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")

ODS1_1_final %>%
  count(REGIAO = factor(REGIAO), PobExtrIBGE_2017 = factor(PobExtrIBGE_2017)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = PobExtrIBGE_2017,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 1.1 (IBGE) - Pobreza extrema (2017)") %>%
  
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2)) %>%
  
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```

<br>

**Distribuição espacial**

```{r ODS1_1_MAPA_NEONATAL_IBGE, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS1_1_MAPA_IBGE <- 
  SHP_Mun_join_1_1 %>%
  filter(!is.na(PobExtrIBGE_2017)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "PobExtrIBGE_2017", 
         title = "ODS 1.1: % da pop em pobreza extrema", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS Meta 1.1 (IBGE) - Pobreza extrema (2017)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  

ODS1_1_MAPA_IBGE

```



<br>

<br>



#### Resumo por biomas

```{r ODS1_1_Tabela_Biomas__IBGE, echo=FALSE, message=FALSE, warning=FALSE}

ODS1_1_SUMARIObioma_IBGE <- ODS1_1_final %>%
  group_by(`Bioma 1`, PobExtrIBGE_2017) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = PobExtrIBGE_2017, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS1_1_SUMARIObioma_IBGE <- ODS1_1_SUMARIObioma_IBGE[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")

ODS1_1_NEO_SUMARIObioma_IBGE_kbl <- kbl(ODS1_1_SUMARIObioma_IBGE,
    col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 1.1 - Critérios IBGE") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS1_1_NEO_SUMARIObioma_IBGE_kbl

```


<br>

<br>


#### Resumo por tipologias


```{r ODS1_1_Tabela_Tipologia_NEONATAL_IBGE, echo=FALSE, message=FALSE, warning=FALSE}

ODS1_1_SUMARIOtipologia_IBGE <- ODS1_1_final %>%
  group_by(`Tipologia Veiga (2002)`, PobExtrIBGE_2017) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = PobExtrIBGE_2017, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS1_1_SUMARIOtipologia_IBGE <- ODS1_1_SUMARIOtipologia_IBGE[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]

ODS1_1_SUMARIOtipologia_IBGE$`Tipologia Veiga (2002)` <- factor(ODS1_1_SUMARIOtipologia_IBGE$`Tipologia Veiga (2002)`, levels = c("Rural",
                                                                                                  "Intermediário",
                                                                                                  "Urbano"))
  
options(knitr.kable.NA = "Não há")


ODS1_1_SUMARIOtipologia_IBGE <- kbl(ODS1_1_SUMARIOtipologia_IBGE,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 1.1 - Critérios IBGE") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS1_1_SUMARIOtipologia_IBGE



```


<br>
<br>

------

<br>
<br>


# ODS 2 - Fome zero e agricultura sustentável


**ODS 2: Acabar com a fome, alcançar a segurança alimentar e melhoria da nutrição e promover a agricultura sustentável**

O segundo ODS, associado à alimentação e agricultura, será analisado utilizando a meta 2.1, que trata da tentativa de erradicar a fome. Por ausência de indicador definido pelo IBGE, será utilizado o indicador de prevalência de subalimentação em crianças de 0 a 2 anos no ano de 2015, sendo os municípios com valores zerados considerados como aqueles que atingiram a meta.

* Meta 2.1 
  + **ONU**: Até 2030, acabar com a fome e garantir o acesso de todas as pessoas, em particular os pobres e pessoas em situações vulneráveis, incluindo crianças, a alimentos seguros, nutritivos e suficientes durante todo o ano.
  + **IBGE/IPEA**: Até 2030, erradicar a fome e garantir o acesso de todas as pessoas, em particular os pobres e pessoas em situações vulneráveis, incluindo crianças e idosos, a alimentos seguros, culturalmente adequados, saudáveis e suficientes durante todo o ano.



```{r ONU2_1_Tabelas, message=FALSE, warning=FALSE, include=FALSE}

ODS2_1 <- read_excel("data/ODS_Bases_consolidadas/ODS2_Indicador_2_1_1_Prevalencia_Subalimentacao_0_2_anos.xlsx", 
    col_types = c("text", "text", "text", "text", "text", "numeric", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric")) %>%
  mutate(REGIAO = case_when(uf == "AC" ~ "Norte",
                            uf == "AP" ~ "Norte",
                            uf == "AM" ~ "Norte",
                            uf == "PA" ~ "Norte",
                            uf == "RO" ~ "Norte",
                            uf == "RR" ~ "Norte",
                            uf == "TO" ~ "Norte",
                            
                            uf == "AL" ~ "Nordeste",
                            uf == "BA" ~ "Nordeste",
                            uf == "CE" ~ "Nordeste",
                            uf == "MA" ~ "Nordeste",
                            uf == "PB" ~ "Nordeste",
                            uf == "PI" ~ "Nordeste",
                            uf == "PE" ~ "Nordeste",
                            uf == "RN" ~ "Nordeste",
                            uf == "SE" ~ "Nordeste",
                            
                            uf == "DF" ~ "Centro-Oeste",
                            uf == "GO" ~ "Centro-Oeste",
                            uf == "MT" ~ "Centro-Oeste",
                            uf == "MS" ~ "Centro-Oeste",
                            
                            uf == "ES" ~ "Sudeste",
                            uf == "MG" ~ "Sudeste",
                            uf == "RJ" ~ "Sudeste",
                            uf == "SP" ~ "Sudeste",
                            
                            uf == "PR" ~ "Sul",
                            uf == "RS" ~ "Sul",
                            uf == "SC" ~ "Sul"))



names(ODS2_1)[1] <- "COD"

```

```{r ODS2_1_CalculoCategorias, message=FALSE, warning=FALSE, include=FALSE}

ODS2_1_CORTES <- ODS2_1 %>% 
  summarise(Subalim_2015_QUARTIL = quantile(ODS2_1[ODS2_1$Subalim_2015 > 0,]$`Subalim_2015`, c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE), 
            Subalim_2015_JENKS = BAMMtools::getJenksBreaks(ODS2_1[ODS2_1$Subalim_2015 > 0,]$`Subalim_2015`, 5),
           )
            
 
ODS2_1_final <- ODS2_1 %>%
  mutate(
    Subalim_2015_JENKS = 
           case_when(Subalim_2015 == 0 ~ "Meta ODS atingida",
                     Subalim_2015 > 0                                    & Subalim_2015 <= ODS2_1_CORTES[2,]$Subalim_2015_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     Subalim_2015 > ODS2_1_CORTES[2,]$Subalim_2015_JENKS & Subalim_2015 <= ODS2_1_CORTES[3,]$Subalim_2015_JENKS ~ "Meta ODS próxima de ser atingida",
                     Subalim_2015 > ODS2_1_CORTES[3,]$Subalim_2015_JENKS & Subalim_2015 <= ODS2_1_CORTES[4,]$Subalim_2015_JENKS ~ "Meta ODS distante de ser atingida",
                     Subalim_2015 > ODS2_1_CORTES[4,]$Subalim_2015_JENKS & Subalim_2015 <= ODS2_1_CORTES[5,]$Subalim_2015_JENKS ~ "Meta ODS muito distante de ser atingida"
                     )
    )
    
   


ODS2_1_final$Subalim_2015_JENKS <- factor(ODS2_1_final$Subalim_2015_JENKS, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))



ODS2_1_SUMARIOgeral <- ODS2_1_final %>%
  group_by(`Bioma 1`, `Tipologia Veiga (2002)`, Subalim_2015_JENKS) %>%
  summarise(contagem = n())

```

```{r ODS2_1_JOIN SHP, message=FALSE, warning=FALSE, include=FALSE}
# Juntando o shape e a tabela
SHP_Mun_join_2_1 <- SHP_Municipios %>%
  left_join(., ODS2_1_final, by = "COD")

```


<br>

<br>


O mapa abaixo mostra a distribuição espacial geral dos dados no Brasil:

```{r ODS2_1_MAPA_NEONATAL_GERAL, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS2_1_MAPA_GERAL <- 
  SHP_Mun_join_2_1 %>%
  filter(!is.na(Subalim_2015)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "Subalim_2015", 
          title = "ODS 2.1 - Prevalência de \nsubnutrição em crianças \nde 0 a 2 anos(2015)", 
          id = "nome", 
          palette=c("#5e4fa2", "#66c2a5", "#e6f598", "#fee08b", "#f46d43","#9e0142"),

          n=6,
          #legend.format=list(fun=function(x) paste(formatC(x, digits=0, big.mark = " ", format="f"))),
          style = "fisher") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 2.1: Prevalência de subnutrição", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), "%"))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000)) 

ODS2_1_MAPA_GERAL

```

<br>

Abaixo, a tabela apresenta as médias de valores por região do Brasil em 2015:


```{r ODS2_1 TabelaRegiao, echo=FALSE, message=FALSE, warning=FALSE}
ODS2_1 %>%
  group_by(REGIAO) %>%
  summarise(`Média da prevalência de subnutrição` = scales::percent(mean(Subalim_2015/100, na.rm = TRUE), accuracy = 0.01)) %>%
  kbl(align = "ccrlrlrlrlrl",
    caption = "ODS Meta 2.1 - Prevalência de subnutrição em crianças de 0 a 2 anos") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```



## Critérios únicos (ONU e IBGE/IPEA)


**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da ONU.

* Meta ODS atingida: 0% de crianças subnutridas.
* Meta ODS muito próxima de ser atingida: De `r round(ODS2_1_CORTES[1,]$Subalim_2015_JENKS, 2)`% a `r round(ODS2_1_CORTES[2,]$Subalim_2015_JENKS, 2)`%.
* Meta ODS próxima de ser atingida: De `r round(ODS2_1_CORTES[2,]$Subalim_2015_JENKS, 2)`% a `r round(ODS2_1_CORTES[3,]$Subalim_2015_JENKS, 2)`%.
* Meta ODS distante de ser atingida: De `r round(ODS2_1_CORTES[3,]$Subalim_2015_JENKS, 2)`% a `r round(ODS2_1_CORTES[4,]$Subalim_2015_JENKS, 2)`%.
* Meta ODS muito distante de ser atingida: De `r round(ODS2_1_CORTES[4,]$Subalim_2015_JENKS, 2)`% a `r round(ODS2_1_CORTES[5,]$Subalim_2015_JENKS, 2)`%.




**Resumo por região**

```{r ODS2_1 TabelaRegiao_ONU_neo, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")
ODS2_1_final %>%
  filter(!is.na(Subalim_2015_JENKS)) %>%
  count(REGIAO = factor(REGIAO), Subalim_2015_JENKS = factor(Subalim_2015_JENKS)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = Subalim_2015_JENKS,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 2.1 - Prevalência de subnutrição em crianças de 0 a 2 anos (2015)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))  %>%
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2))

```




**Distribuição espacial**

```{r ODS2_1_MAPA, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS2_1_MAPA <- 
  SHP_Mun_join_2_1 %>%
  filter(!is.na(Subalim_2015_JENKS)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "Subalim_2015_JENKS", 
         title = "ODS 2.1 - % de crianças de \n0 a 2 anos subnutridas", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 2.1 - Prevalência de subnutrição em \ncrianças de 0 a 2 anos (2015)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  

ODS2_1_MAPA


```




#### Resumo por biomas

```{r ODS2_1_Tabela_Biomas_, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 4.1 ####

ODS2_1_SUMARIObioma <- ODS2_1_final %>%
  filter(!is.na(Subalim_2015_JENKS)) %>% 
  group_by(`Bioma 1`, Subalim_2015_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = Subalim_2015_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )



ODS2_1_SUMARIObioma <- ODS2_1_SUMARIObioma[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")


ODS2_1_SUMARIObioma_kbl <- kbl(ODS2_1_SUMARIObioma,
                               col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 2.1 - Prevalência de subnutrição em crianças de 0 a 2 anos (2015)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS2_1_SUMARIObioma_kbl

```

#### Resumo por tipologias


```{r ODS2_1_Tabela_Tipologia_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE}

ODS2_1_SUMARIOtipologia <- ODS2_1_final %>%
  group_by(`Tipologia Veiga (2002)`, Subalim_2015_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = Subalim_2015_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS2_1_SUMARIOtipologia <- ODS2_1_SUMARIOtipologia[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS2_1_SUMARIOtipologia$`Tipologia Veiga (2002)` <- factor(ODS2_1_SUMARIOtipologia$`Tipologia Veiga (2002)`, levels = c("Rural", 
                                                                                                                                          "Intermediário", 
                                                                                                                                          "Urbano"))

options(knitr.kable.NA = "Não há")

ODS2_1_SUMARIOtipologia_kbl <- kbl(ODS2_1_SUMARIOtipologia,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 2.1 - Prevalência de subnutrição em crianças de 0 a 2 anos (2015)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS2_1_SUMARIOtipologia_kbl

```

<br>
<br>

------

<br>
<br>



# ODS 3 - Saúde e bem-estar 

```{r ODS3_Tabelas, message=FALSE, warning=FALSE, include=FALSE}

ODS3_2a <- read_excel("data/ODS_Bases_consolidadas/ODS3_Indicador_3_2_2_a_mortalidade_infantil_ate28dias.xlsx", 
    col_types = c("text", "text", "text", "text", "text", "numeric", "text", "text", "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric", "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric",   "numeric", "numeric", "numeric",   "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric",   "numeric", "numeric", "numeric",   "numeric", "numeric", "numeric",   "numeric", "numeric", "numeric"))

names(ODS3_2a)[1] <- "COD"

ODS3_2b <- read_excel("data/ODS_Bases_consolidadas/ODS3_Indicador_3_2_2_b_mortalidade_infantil_0_4anos.xlsx", 
    col_types = c("text", "text", "text", 
        "text", "text", "numeric", "text", 
        "text", "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric", "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric", "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric", "numeric", "numeric", "numeric",   "numeric", "numeric", "numeric",  "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric","numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric")) %>%
  select(-c(2:8))

names(ODS3_2b)[1] <- "COD"


ODS3_2 <- full_join(ODS3_2a, ODS3_2b, by = "COD")

ODS3_2 <- ODS3_2 %>%
  mutate(REGIAO = case_when(uf == "AC" ~ "Norte",
                            uf == "AP" ~ "Norte",
                            uf == "AM" ~ "Norte",
                            uf == "PA" ~ "Norte",
                            uf == "RO" ~ "Norte",
                            uf == "RR" ~ "Norte",
                            uf == "TO" ~ "Norte",
                            
                            uf == "AL" ~ "Nordeste",
                            uf == "BA" ~ "Nordeste",
                            uf == "CE" ~ "Nordeste",
                            uf == "MA" ~ "Nordeste",
                            uf == "PB" ~ "Nordeste",
                            uf == "PI" ~ "Nordeste",
                            uf == "PE" ~ "Nordeste",
                            uf == "RN" ~ "Nordeste",
                            uf == "SE" ~ "Nordeste",
                            
                            uf == "DF" ~ "Centro-Oeste",
                            uf == "GO" ~ "Centro-Oeste",
                            uf == "MT" ~ "Centro-Oeste",
                            uf == "MS" ~ "Centro-Oeste",
                            
                            uf == "ES" ~ "Sudeste",
                            uf == "MG" ~ "Sudeste",
                            uf == "RJ" ~ "Sudeste",
                            uf == "SP" ~ "Sudeste",
                            
                            uf == "PR" ~ "Sul",
                            uf == "RS" ~ "Sul",
                            uf == "SC" ~ "Sul"))

```

```{r ODS3_2_CalculoCategorias, message=FALSE, warning=FALSE, include=FALSE}

ODS3_2_CORTES <- ODS3_2 %>% 
  summarise(mortNEO_ONU17_QUARTIL = quantile(ODS3_2[ODS3_2$TxMor17_neonatal_total > 12,]$`TxMor17_neonatal_total`, c(0, 0.25, 0.5, 0.75, 1)), 
            mortINF_ONU17_QUARTIL = quantile(ODS3_2[ODS3_2$TxMor17_0a4_total > 25,]$`TxMor17_0a4_total`, c(0, 0.25, 0.5, 0.75, 1)), 
            
            
            mortNEO_IBGE17_QUARTIL = quantile(ODS3_2[ODS3_2$TxMor17_neonatal_total > 5,]$`TxMor17_neonatal_total`, c(0, 0.25, 0.5, 0.75, 1)),
            mortINF_IBGE17_QUARTIL = quantile(ODS3_2[ODS3_2$TxMor17_0a4_total > 8,]$`TxMor17_0a4_total`, c(0, 0.25, 0.5, 0.75, 1)),
            
            
            mortNEO_ONU17_JENKS = BAMMtools::getJenksBreaks(ODS3_2[ODS3_2$TxMor17_neonatal_total > 12,]$`TxMor17_neonatal_total`, 5),
            mortNEO_IBGE17_JENKS = BAMMtools::getJenksBreaks(ODS3_2[ODS3_2$TxMor17_neonatal_total > 5,]$`TxMor17_neonatal_total`, 5),
            
            mortINF_ONU17_JENKS = BAMMtools::getJenksBreaks(ODS3_2[ODS3_2$TxMor17_0a4_total > 25,]$`TxMor17_0a4_total`, 5) ,
            mortINF_IBGE17_JENKS = BAMMtools::getJenksBreaks(ODS3_2[ODS3_2$TxMor17_0a4_total > 8,]$`TxMor17_0a4_total`, 5) 
            )
            
            #pobr_ext_IBGE2017_5 = BAMMtools::getJenksBreaks(ODS3_2[ODS3_2$p_pes_pobr_ext_ONU_2017 > 3,]$`p_pes_pobr_ext_ONU_2017`, 5)
            
            #contagem = count(ODS3_2$p_pes_pobr_ext_ONU_2017 > 50)
            
  

# ODS3_2NEO_Jenks <- as.data.frame(BAMMtools::getJenksBreaks(ODS3_2[ODS3_2$TxMor17_neonatal_total > 12,]$`TxMor17_neonatal_total`, 5))
# ODS3_2NEO_Jenks <- bind_cols(ODS3_2NEO_Jenks, as.data.frame(BAMMtools::getJenksBreaks(ODS3_2[ODS3_2$TxMor17_neonatal_total > 5,]$`TxMor17_neonatal_total`, 5)))
# 
# ODS3_2INF_Jenks <- as.data.frame(BAMMtools::getJenksBreaks(ODS3_2[ODS3_2$TxMor17_0a4_total > 25,]$`TxMor17_0a4_total`, 5))
# ODS3_2INF_Jenks <- bind_cols(ODS3_2INF_Jenks, as.data.frame(BAMMtools::getJenksBreaks(ODS3_2[ODS3_2$TxMor17_0a4_total > 8,]$`TxMor17_0a4_total`, 5)))



ODS3_2_final <- ODS3_2 %>%
  mutate(
    mortNEO_ONU17_JENKS = 
           case_when(TxMor17_neonatal_total <= 12 ~ "Meta ODS atingida",
                     TxMor17_neonatal_total > 12                                    & TxMor17_neonatal_total <= ODS3_2_CORTES[2,]$mortNEO_ONU17_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[2,]$mortNEO_ONU17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[3,]$mortNEO_ONU17_JENKS ~ "Meta ODS próxima de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[3,]$mortNEO_ONU17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[4,]$mortNEO_ONU17_JENKS ~ "Meta ODS distante de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[4,]$mortNEO_ONU17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[5,]$mortNEO_ONU17_JENKS ~ "Meta ODS muito distante de ser atingida"
                     
                     ),
    
    mortNEO_IBGE17_JENKS = 
           case_when(TxMor17_neonatal_total <= 5 ~ "Meta ODS atingida",
                     TxMor17_neonatal_total > 5 & TxMor17_neonatal_total <= ODS3_2_CORTES[2,]$mortNEO_IBGE17_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[2,]$mortNEO_IBGE17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[3,]$mortNEO_IBGE17_JENKS ~ "Meta ODS próxima de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[3,]$mortNEO_IBGE17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[4,]$mortNEO_IBGE17_JENKS ~ "Meta ODS distante de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[4,]$mortNEO_IBGE17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[5,]$mortNEO_IBGE17_JENKS ~ "Meta ODS muito distante de ser atingida"
                     
                     ),
    
    mortINF_ONU17_JENKS = 
           case_when(TxMor17_neonatal_total <= 25 ~ "Meta ODS atingida",
                     TxMor17_neonatal_total > 25                                     & TxMor17_neonatal_total <= ODS3_2_CORTES[2,]$mortINF_ONU17_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[2,]$mortINF_ONU17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[3,]$mortINF_ONU17_JENKS ~ "Meta ODS próxima de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[3,]$mortINF_ONU17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[4,]$mortINF_ONU17_JENKS ~ "Meta ODS distante de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[4,]$mortINF_ONU17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[5,]$mortINF_ONU17_JENKS ~ "Meta ODS muito distante de ser atingida"
                     
                     ),
    
    mortINF_IBGE17_JENKS = 
           case_when(TxMor17_neonatal_total <= 8 ~ "Meta ODS atingida",
                     TxMor17_neonatal_total > 8                                     & TxMor17_neonatal_total <= ODS3_2_CORTES[2,]$mortINF_IBGE17_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[2,]$mortINF_IBGE17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[3,]$mortINF_IBGE17_JENKS ~ "Meta ODS próxima de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[3,]$mortINF_IBGE17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[4,]$mortINF_IBGE17_JENKS ~ "Meta ODS distante de ser atingida",
                     TxMor17_neonatal_total > ODS3_2_CORTES[4,]$mortINF_IBGE17_JENKS & TxMor17_neonatal_total <= ODS3_2_CORTES[5,]$mortINF_IBGE17_JENKS ~ "Meta ODS muito distante de ser atingida"
                     
                     )
    )
    
   


ODS3_2_final$mortNEO_ONU17_JENKS <- factor(ODS3_2_final$mortNEO_ONU17_JENKS, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))

ODS3_2_final$mortNEO_IBGE17_JENKS <- factor(ODS3_2_final$mortNEO_IBGE17_JENKS, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))

ODS3_2_final$mortINF_ONU17_JENKS <- factor(ODS3_2_final$mortINF_ONU17_JENKS, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))

ODS3_2_final$mortINF_IBGE17_JENKS <- factor(ODS3_2_final$mortINF_IBGE17_JENKS, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))



ODS3_2_SUMARIOgeral <- ODS3_2_final %>%
  group_by(`Bioma 1`, `Tipologia Veiga (2002)`, mortNEO_ONU17_JENKS, mortNEO_IBGE17_JENKS, mortINF_ONU17_JENKS, mortINF_IBGE17_JENKS) %>%
  summarise(contagem = n())

```

```{r ODS3_2_JOIN SHP, message=FALSE, warning=FALSE, include=FALSE}
# Juntando o shape e a tabela
SHP_Mun_join_3_2 <- SHP_Municipios %>%
  left_join(., ODS3_2_final, by = "COD")

```

**ODS 3: Assegurar uma vida saudável e promover o bem-estar para todos, em todas as idades**

O terceiro ODS, associado à saúde e bem-estar, será analisado utilizando a meta 3.2, que trata da mortalidade neonatal e infantil, com dados do ano de 2017.

* Meta 3.2:
  + **ONU:** Até 2030, acabar com as mortes evitáveis de recém-nascidos e crianças menores de 5 anos, com todos os países objetivando reduzir a mortalidade neonatal para pelo menos 12 por 1.000 nascidos vivos e a mortalidade de crianças menores de 5 anos para pelo menos 25 por 1.000 nascidos vivos.
  + **IBGE/IPEA**
Até 2030, enfrentar as mortes evitáveis de recém-nascidos e crianças menores de 5 anos, objetivando reduzir a mortalidade neonatal para no máximo 5 por mil nascidos vivos e a mortalidade de crianças menores de 5 anos para no máximo 8 por mil nascidos vivos.



O mapa abaixo mostra a distribuição espacial geral dos dados no Brasil:

```{r ODS3_2_MAPA_NEONATAL_GERAL, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}


ODS3_2_MAPA_NEONATAL_GERAL <-
  SHP_Mun_join_3_2 %>%
  filter(!is.na(TxMor17_neonatal_total)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "TxMor17_neonatal_total", 
          title = "Mortalidade neonatal \n(por mil nascidos vivos)", 
          id = "nome", 
          palette=c("#5e4fa2", "#66c2a5", "#e6f598", "#fee08b", "#f46d43","#9e0142"),

          n=6,
          style = "fisher") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 3.2: Mortalidade neonatal", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000)) 




ODS3_2_MAPA_INFANTIL_GERAL <-
  SHP_Mun_join_3_2 %>%
  filter(!is.na(TxMor17_0a4_total)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "TxMor17_0a4_total", 
          title = "Mortalidade infantil \n(por mil nascidos vivos)", 
          id = "nome", 
          palette=c("#5e4fa2", "#66c2a5", "#e6f598", "#fee08b", "#f46d43","#9e0142"),

          n=6,
          style = "fisher") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 3.2: Mortalidade infantil", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("RIGHT", "TOP"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("RIGHT", "bottom"), breaks = c(0,500,1000)) 



tmap_arrange(ODS3_2_MAPA_NEONATAL_GERAL, ODS3_2_MAPA_INFANTIL_GERAL, 
             sync = TRUE, 
             nrow = 1)

```

<br>

Abaixo, a tabela apresenta as médias de valores por região do Brasil para a mortalidade neonatal e infantil em 2017:


```{r ODS3_2 TabelaRegiao, echo=FALSE, message=FALSE, warning=FALSE}
ODS3_2 %>%
  group_by(REGIAO) %>%
  summarise(`Tx. de mortalidade neonatal` = round(mean(TxMor17_neonatal_total), 2),
            `Tx. de mortalidade infantil` = round(mean(TxMor17_0a4_total), 2)) %>%
  kbl(align = "ccc",
    caption = "ODS Meta 3.2 - Mortalidade infantil e neonatal (2017)*") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_footnote("*Taxa de Mortalidade neonatal considerada para crianças de até 28 dias (por mil nascidos vivos) e mortalidade infantil para crianças de 0 a 4 anos de idade (por mil nascidos vivos).") 


```



<br>

------

<br>


## Critérios ONU 

### Neonatal

**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da ONU.

* Meta ODS atingida: De 0 a 12 por mil nascidos vivos.
* Meta ODS muito próxima de ser atingida: De `r round(ODS3_2_CORTES[1,]$mortNEO_ONU17_JENKS, 2)` a `r round(ODS3_2_CORTES[2,]$mortNEO_ONU17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS próxima de ser atingida: De `r round(ODS3_2_CORTES[2,]$mortNEO_ONU17_JENKS, 2)` a `r round(ODS3_2_CORTES[3,]$mortNEO_ONU17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS distante de ser atingida: De `r round(ODS3_2_CORTES[3,]$mortNEO_ONU17_JENKS, 2)` a `r round(ODS3_2_CORTES[4,]$mortNEO_ONU17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS muito distante de ser atingida: De `r round(ODS3_2_CORTES[4,]$mortNEO_ONU17_JENKS, 2)` a `r round(ODS3_2_CORTES[5,]$mortNEO_ONU17_JENKS, 2)` por mil nascidos vivos.


**Resumo por região**

```{r ODS3_2 TabelaRegiao_ONU_neo, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")
ODS3_2_final %>%
  count(REGIAO = factor(REGIAO), mortNEO_ONU17_JENKS = factor(mortNEO_ONU17_JENKS)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = mortNEO_ONU17_JENKS,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 3.2 (ONU) - Mortalidade neonatal (2017)") %>%
  
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2)) %>%
  
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```

**Distribuição espacial**

```{r ODS3_2_MAPA_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS3_2_MAPA_NEONATAL_ONU <- 
  SHP_Mun_join_3_2 %>%
  filter(!is.na(mortNEO_ONU17_JENKS)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "mortNEO_ONU17_JENKS", 
         title = "ODS 3.2: Mortalidade neonatal (ONU)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "Meta ODS 3.2: Mortalidade neonatal (ONU)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  

ODS3_2_MAPA_NEONATAL_ONU

```



<br>

<br>



#### Resumo por biomas

```{r ODS3_2_Tabela_Biomas_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 3.2 - NEONATAL ONU ####

ODS3_2_NEO_SUMARIObioma_ONU <- ODS3_2_final %>%
  group_by(`Bioma 1`, mortNEO_ONU17_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = mortNEO_ONU17_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS3_2_NEO_SUMARIObioma_ONU <- ODS3_2_NEO_SUMARIObioma_ONU[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")


ODS3_2_NEO_SUMARIObioma_ONU_kbl <- kbl(ODS3_2_NEO_SUMARIObioma_ONU,
    col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 3.2 [Mortalidade neonatal] - Critérios ONU") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS3_2_NEO_SUMARIObioma_ONU_kbl

```



<br>

<br>



#### Resumo por tipologias


```{r ODS3_2_Tabela_Tipologia_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 3.2 NEO - ONU ####

ODS3_2_NEO_SUMARIOtipologia_ONU <- ODS3_2_final %>%
  group_by(`Tipologia Veiga (2002)`, mortNEO_ONU17_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = mortNEO_ONU17_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS3_2_NEO_SUMARIOtipologia_ONU <- ODS3_2_NEO_SUMARIOtipologia_ONU[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS3_2_NEO_SUMARIOtipologia_ONU$`Tipologia Veiga (2002)` <- factor(ODS3_2_NEO_SUMARIOtipologia_ONU$`Tipologia Veiga (2002)`, levels = c("Rural", 
                                                                                                                                          "Intermediário", 
                                                                                                                                          "Urbano"))

options(knitr.kable.NA = "Não há")

ODS3_2_NEO_SUMARIOtipologia_ONU_kbl <- kbl(ODS3_2_NEO_SUMARIOtipologia_ONU,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 3.2 [mortalidade neonatal] - Critérios ONU") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS3_2_NEO_SUMARIOtipologia_ONU_kbl

```



<br>

------

<br>


### Infantil

**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da ONU.

* Meta ODS atingida: De 0 a 25 por mil nascidos vivos.
* Meta ODS muito próxima de ser atingida: De `r round(ODS3_2_CORTES[1,]$mortINF_ONU17_JENKS, 2)` a `r round(ODS3_2_CORTES[2,]$mortINF_ONU17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS próxima de ser atingida: De `r round(ODS3_2_CORTES[2,]$mortINF_ONU17_JENKS, 2)` a `r round(ODS3_2_CORTES[3,]$mortINF_ONU17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS distante de ser atingida: De `r round(ODS3_2_CORTES[3,]$mortINF_ONU17_JENKS, 2)` a `r round(ODS3_2_CORTES[4,]$mortINF_ONU17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS muito distante de ser atingida: De `r round(ODS3_2_CORTES[4,]$mortINF_ONU17_JENKS, 2)` a `r round(ODS3_2_CORTES[5,]$mortINF_ONU17_JENKS, 2)` por mil nascidos vivos.



<br>

<br>


**Resumo por região**

```{r ODS3_2 TabelaRegiao_ONU_INF, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")
ODS3_2_final %>%
  count(REGIAO = factor(REGIAO), mortINF_ONU17_JENKS = factor(mortINF_ONU17_JENKS)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = mortINF_ONU17_JENKS,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 3.2 (ONU) - Mortalidade infantil (2017)*") %>%
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2)) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```



**Distribuição espacial**

```{r ODS3_2_MAPA_INFANTIL_ONU, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS3_2_MAPA_INFANTIL_ONU <- SHP_Mun_join_3_2 %>%
  filter(!is.na(mortINF_ONU17_JENKS)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "mortINF_ONU17_JENKS", 
         title = "ODS 3.2: Mortalidade neonatal (ONU)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "Meta ODS 3.2: Mortalidade infantil (ONU)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))

ODS3_2_MAPA_INFANTIL_ONU

```



<br>

<br>




#### Resumo por biomas

```{r ODS3_2_Tabela_Biomas_INFANTIL_ONU, echo=FALSE, message=FALSE, warning=FALSE}


#### ODS 3.2 - infantil ONU ####

ODS3_2_INF_SUMARIObioma_ONU <- ODS3_2_final %>%
  group_by(`Bioma 1`, mortINF_ONU17_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = mortINF_ONU17_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS3_2_INF_SUMARIObioma_ONU <- ODS3_2_INF_SUMARIObioma_ONU[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")

ODS3_2_INF_SUMARIObioma_ONU_kbl <- kbl(ODS3_2_INF_SUMARIObioma_ONU,
    col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 3.2 [Mortalidade infantil] - Critérios ONU") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS3_2_INF_SUMARIObioma_ONU_kbl

```
 
 
 
 
 
#### Resumo por tipologias

```{r ODS3_2_Tabela_Tipologia_INFANTIL_ONU, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 3.2 INF - ONU ####

ODS3_2_INF_SUMARIOtipologia_ONU <- ODS3_2_final %>%
  group_by(`Tipologia Veiga (2002)`, mortINF_ONU17_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = mortINF_ONU17_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS3_2_INF_SUMARIOtipologia_ONU <- ODS3_2_INF_SUMARIOtipologia_ONU[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS3_2_INF_SUMARIOtipologia_ONU$`Tipologia Veiga (2002)` <- factor(ODS3_2_INF_SUMARIOtipologia_ONU$`Tipologia Veiga (2002)`, levels = c("Rural", 
                                                                                                                                          "Intermediário", 
                                                                                                                                          "Urbano"))

options(knitr.kable.NA = "Não há")

ODS3_2_INF_SUMARIOtipologia_ONU_kbl <- kbl(ODS3_2_INF_SUMARIOtipologia_ONU,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 3.2 [mortalidade infantil] - Critérios ONU") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS3_2_INF_SUMARIOtipologia_ONU_kbl

```



<br>

------

<br>


## Critérios IBGE/IPEA 

### Neonatal

**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da IBGE.

* Meta ODS atingida: De 0 a 5 por mil nascidos vivos.
* Meta ODS muito próxima de ser atingida: De `r round(ODS3_2_CORTES[1,]$mortNEO_IBGE17_JENKS, 2)` a `r round(ODS3_2_CORTES[2,]$mortNEO_IBGE17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS próxima de ser atingida: De `r round(ODS3_2_CORTES[2,]$mortNEO_IBGE17_JENKS, 2)` a `r round(ODS3_2_CORTES[3,]$mortNEO_IBGE17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS distante de ser atingida: De `r round(ODS3_2_CORTES[3,]$mortNEO_IBGE17_JENKS, 2)` a `r round(ODS3_2_CORTES[4,]$mortNEO_IBGE17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS muito distante de ser atingida: De `r round(ODS3_2_CORTES[4,]$mortNEO_IBGE17_JENKS, 2)` a `r round(ODS3_2_CORTES[5,]$mortNEO_IBGE17_JENKS, 2)` por mil nascidos vivos.


<br>

<br>



**Resumo por região**

```{r ODS3_2 TabelaRegiao_IBGE_neo, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")
ODS3_2_final %>%
  count(REGIAO = factor(REGIAO), mortNEO_IBGE17_JENKS = factor(mortNEO_IBGE17_JENKS)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = mortNEO_IBGE17_JENKS,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 3.2 (IBGE) - Mortalidade neonatal (2017)") %>%
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2)) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```




<br>

<br>


**Distribuição espacial**

```{r ODS3_2_MAPA_NEONATAL_IBGE, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS3_2_MAPA_NEONATAL_IBGE <- 
  SHP_Mun_join_3_2 %>%
  filter(!is.na(mortNEO_IBGE17_JENKS)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "mortNEO_IBGE17_JENKS", 
         title = "ODS 3.2: Mortalidade neonatal (IBGE)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "Meta ODS 3.2: Mortalidade neonatal (IBGE)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  

ODS3_2_MAPA_NEONATAL_IBGE

```





#### Resumo por biomas

```{r ODS3_2_Tabela_Biomas_NEONATAL_IBGE, echo=FALSE, message=FALSE, warning=FALSE}
#### ODS 3.2 - NEONATAL IBGE ####

ODS3_2_NEO_SUMARIObioma_IBGE <- ODS3_2_final %>%
  group_by(`Bioma 1`, mortNEO_IBGE17_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = mortNEO_IBGE17_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS3_2_NEO_SUMARIObioma_IBGE <- ODS3_2_NEO_SUMARIObioma_IBGE[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")

ODS3_2_NEO_SUMARIObioma_IBGE_kbl <- kbl(ODS3_2_NEO_SUMARIObioma_IBGE,
    col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 3.2 [Mortalidade neonatal] - Critérios IPEA/IBGE") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS3_2_NEO_SUMARIObioma_IBGE_kbl

```


<br>

<br>




#### Resumo por tipologias

```{r ODS3_2_Tabela_Tipologia_NEONATAL_IBGE, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 3.2 NEO - IBGE ####

ODS3_2_NEO_SUMARIOtipologia_IBGE <- ODS3_2_final %>%
  group_by(`Tipologia Veiga (2002)`, mortNEO_IBGE17_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = mortNEO_IBGE17_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS3_2_NEO_SUMARIOtipologia_IBGE <- ODS3_2_NEO_SUMARIOtipologia_IBGE[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS3_2_NEO_SUMARIOtipologia_IBGE$`Tipologia Veiga (2002)` <- factor(ODS3_2_NEO_SUMARIOtipologia_IBGE$`Tipologia Veiga (2002)`, levels = c("Rural", 
                                                                                                                                          "Intermediário", 
                                                                                                                                          "Urbano"))

options(knitr.kable.NA = "Não há")

ODS3_2_NEO_SUMARIOtipologia_IBGE_kbl <- kbl(ODS3_2_NEO_SUMARIOtipologia_IBGE,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 3.2 [mortalidade neonatal] - Critérios IPEA/IBGE") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS3_2_NEO_SUMARIOtipologia_IBGE_kbl

```


<br>

------

<br>

### Infantil

**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta do Brasil

* Meta ODS atingida: De 0 a 8 por mil nascidos vivos.
* Meta ODS muito próxima de ser atingida: De `r round(ODS3_2_CORTES[1,]$mortINF_IBGE17_JENKS, 2)` a `r round(ODS3_2_CORTES[2,]$mortINF_IBGE17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS próxima de ser atingida: De `r round(ODS3_2_CORTES[2,]$mortINF_IBGE17_JENKS, 2)` a `r round(ODS3_2_CORTES[3,]$mortINF_IBGE17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS distante de ser atingida: De `r round(ODS3_2_CORTES[3,]$mortINF_IBGE17_JENKS, 2)` a `r round(ODS3_2_CORTES[4,]$mortINF_IBGE17_JENKS, 2)` por mil nascidos vivos.
* Meta ODS muito distante de ser atingida: De `r round(ODS3_2_CORTES[4,]$mortINF_IBGE17_JENKS, 2)` a `r round(ODS3_2_CORTES[5,]$mortINF_IBGE17_JENKS, 2)` por mil nascidos vivos.


<br>
<br>



**Resumo por região**

```{r ODS3_2 TabelaRegiao_IBGE_INF, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")
ODS3_2_final %>%
  count(REGIAO = factor(REGIAO), mortINF_IBGE17_JENKS = factor(mortINF_IBGE17_JENKS)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = mortINF_IBGE17_JENKS,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 3.2 (IBGE) - Mortalidade infantil (2017)") %>%
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2)) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```


<br>
<br>



**Distribuição espacial**

```{r ODS3_2_MAPA_INFANTIL_IBGE, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS3_2_MAPA_INFANTIL_IBGE <- SHP_Mun_join_3_2 %>%
  filter(!is.na(mortINF_IBGE17_JENKS)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "mortINF_IBGE17_JENKS", 
         title = "ODS 3.2: Mortalidade neonatal (IBGE)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "Meta ODS 3.2: Mortalidade infantil (IBGE)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))

ODS3_2_MAPA_INFANTIL_IBGE

```


<br>

<br>



#### Resumo por biomas

```{r ODS3_2_Tabela_Biomas_INFANTIL_IBGE, echo=FALSE, message=FALSE, warning=FALSE}
#### ODS 3.2 - INFANTIL IBGE ####

ODS3_2_INF_SUMARIObioma_IBGE <- ODS3_2_final %>%
  group_by(`Bioma 1`, mortINF_IBGE17_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = mortINF_IBGE17_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS3_2_INF_SUMARIObioma_IBGE <- ODS3_2_INF_SUMARIObioma_IBGE[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")

ODS3_2_INF_SUMARIObioma_IBGE_kbl <- kbl(ODS3_2_INF_SUMARIObioma_IBGE,
    col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 3.2 [Mortalidade infantil] - Critérios IPEA/IBGE") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS3_2_INF_SUMARIObioma_IBGE_kbl

```
 
  
   
<br>


<br>

     
      
      
#### Resumo por tipologias

```{r ODS3_2_Tabela_Tipologia_INFANTIL_IBGE, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 3.2 INF - IBGE ####

ODS3_2_INF_SUMARIOtipologia_IBGE <- ODS3_2_final %>%
  group_by(`Tipologia Veiga (2002)`, mortINF_IBGE17_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = mortINF_IBGE17_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS3_2_INF_SUMARIOtipologia_IBGE <- ODS3_2_INF_SUMARIOtipologia_IBGE[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS3_2_INF_SUMARIOtipologia_IBGE$`Tipologia Veiga (2002)` <- factor(ODS3_2_INF_SUMARIOtipologia_IBGE$`Tipologia Veiga (2002)`, levels = c("Rural", 
                                                                                                                                          "Intermediário", 
                                                                                                                                          "Urbano"))

options(knitr.kable.NA = "Não há")

ODS3_2_INF_SUMARIOtipologia_IBGE_kbl <- kbl(ODS3_2_INF_SUMARIOtipologia_IBGE,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 3.2 [mortalidade infantil] - Critérios IPEA/IBGE") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS3_2_INF_SUMARIOtipologia_IBGE_kbl

```

<br>
<br>

------

<br>
<br>

# ODS 4 - Educação de qualidade 


**ODS 4: Assegurar a educação inclusiva e equitativa e de qualidade, e promover oportunidades de aprendizagem ao longo da vida para todos**

O quarto ODS, associado à educação, será analisado utilizando a meta 4.1. Será utilizado apenas o índice de matrículas no ensino médio de pessoas de 15 a 17 anos (idade de acesso a esse nível considerada adequada) no ano de 2018, uma vez que *"o acesso ao ensino médio representa, atualmente, o maior gargalo dos municípios na promoção da inclusão social pela educação. [...] os níveis de acesso ao ensino fundamental encontram-se mais próximos da universalização, de modo que o indicador de acesso ao ensino médio lança luz, com maior profundidade, sobre os desafios da educação de longo prazo enfrentados pelos municípios brasileiros." (L. F. NOVAIS CONSULTORES LTDA, 2019, p.34)*

* Meta 4.1 
  + **ONU**: Até 2030, garantir que todas as meninas e meninos completem o ensino primário e secundário livre, equitativo e de qualidade, que conduza a resultados de aprendizagem relevantes e eficazes.
  + **IBGE/IPEA**: Até 2030, garantir que todas as meninas e meninos completem o ensino fundamental e médio, equitativo e de qualidade, na idade adequada, assegurando a oferta gratuita na rede pública e que conduza a resultados de aprendizagem satisfatórios e relevantes.



<!-- Na meta 4.A serão analisados........ -->

<!-- * Meta 4.A  -->
<!--   + **ONU**: Construir e melhorar instalações físicas para a educação, apropriadas para crianças e sensíveis às deficiências e ao gênero e que proporcionem ambientes de aprendizagem seguros, não violentos, inclusivos e eficazes para todos. -->
<!--   + **IBGE/IPEA**: Ofertar infraestrutura física escolar adequada às necessidades da criança, acessível às pessoas com deficiências e sensível ao gênero, que garanta a existência de ambientes de aprendizagem seguros, não violentos, inclusivos e eficazes para todos. -->


<!-- 4.a.1 Percentual de escolas com acesso a: i) eletricidade; ii) internet para fins pedagógicos; iii) computadores para fins pedagógicos; iv) infraestrutura e materiais adaptados para estudantes com deficiência; v) água potável; vi) instalações sanitárias para cada sexo; e vii) instalações básicas para lavagem das mãos (de acordo com as definições do indicador WASH). -->


```{r ONU4_1_Tabelas, message=FALSE, warning=FALSE, include=FALSE}

ODS4_1 <- read_excel("data/ODS_Bases_consolidadas/ODS4_Indicador_Matriculas_EM_15a17anos.xls", 
    col_types = c("text", "text", "text", "text", "text", "numeric", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric")) %>%
  mutate(REGIAO = case_when(uf == "AC" ~ "Norte",
                            uf == "AP" ~ "Norte",
                            uf == "AM" ~ "Norte",
                            uf == "PA" ~ "Norte",
                            uf == "RO" ~ "Norte",
                            uf == "RR" ~ "Norte",
                            uf == "TO" ~ "Norte",
                            
                            uf == "AL" ~ "Nordeste",
                            uf == "BA" ~ "Nordeste",
                            uf == "CE" ~ "Nordeste",
                            uf == "MA" ~ "Nordeste",
                            uf == "PB" ~ "Nordeste",
                            uf == "PI" ~ "Nordeste",
                            uf == "PE" ~ "Nordeste",
                            uf == "RN" ~ "Nordeste",
                            uf == "SE" ~ "Nordeste",
                            
                            uf == "DF" ~ "Centro-Oeste",
                            uf == "GO" ~ "Centro-Oeste",
                            uf == "MT" ~ "Centro-Oeste",
                            uf == "MS" ~ "Centro-Oeste",
                            
                            uf == "ES" ~ "Sudeste",
                            uf == "MG" ~ "Sudeste",
                            uf == "RJ" ~ "Sudeste",
                            uf == "SP" ~ "Sudeste",
                            
                            uf == "PR" ~ "Sul",
                            uf == "RS" ~ "Sul",
                            uf == "SC" ~ "Sul"))



names(ODS4_1)[1] <- "COD"

ODS4_a1 <- read_excel("data/ODS_Bases_consolidadas/ODS4_Indicador_4a1_infraestrutura_escolas.xlsx", 
    col_types = c("text", "text", "text",  "text", "text", "numeric", "text",         "text", "numeric", "numeric", "numeric",         "numeric", "numeric", "numeric",         "numeric", "numeric", "numeric",         "numeric", "numeric", "numeric",         "numeric", "numeric", "numeric",         "numeric", "numeric", "numeric",         "numeric", "numeric", "numeric",         "numeric", "numeric", "numeric",         "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric",         "numeric", "numeric", "numeric",         "numeric", "numeric", "numeric",         "numeric", "numeric", "numeric",         "numeric")) %>%
  mutate(REGIAO = case_when(uf == "AC" ~ "Norte",
                            uf == "AP" ~ "Norte",
                            uf == "AM" ~ "Norte",
                            uf == "PA" ~ "Norte",
                            uf == "RO" ~ "Norte",
                            uf == "RR" ~ "Norte",
                            uf == "TO" ~ "Norte",
                            
                            uf == "AL" ~ "Nordeste",
                            uf == "BA" ~ "Nordeste",
                            uf == "CE" ~ "Nordeste",
                            uf == "MA" ~ "Nordeste",
                            uf == "PB" ~ "Nordeste",
                            uf == "PI" ~ "Nordeste",
                            uf == "PE" ~ "Nordeste",
                            uf == "RN" ~ "Nordeste",
                            uf == "SE" ~ "Nordeste",
                            
                            uf == "DF" ~ "Centro-Oeste",
                            uf == "GO" ~ "Centro-Oeste",
                            uf == "MT" ~ "Centro-Oeste",
                            uf == "MS" ~ "Centro-Oeste",
                            
                            uf == "ES" ~ "Sudeste",
                            uf == "MG" ~ "Sudeste",
                            uf == "RJ" ~ "Sudeste",
                            uf == "SP" ~ "Sudeste",
                            
                            uf == "PR" ~ "Sul",
                            uf == "RS" ~ "Sul",
                            uf == "SC" ~ "Sul"))
 

names(ODS4_a1)[1] <- "COD"


```

```{r ODS4_1_CalculoCategorias, message=FALSE, warning=FALSE, include=FALSE}

ODS4_1_CORTES <- ODS4_1 %>% 
  summarise(ind_Matr_EM_18_QUARTIL = quantile(ODS4_1[ODS4_1$Ind_Matr_EM_15a17_2018 < 100,]$`Ind_Matr_EM_15a17_2018`, c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE), 
            ind_Matr_EM_18_JENKS = BAMMtools::getJenksBreaks(ODS4_1[ODS4_1$Ind_Matr_EM_15a17_2018 < 100,]$`Ind_Matr_EM_15a17_2018`, 5),
           )
            
 



ODS4_1_final <- ODS4_1 %>%
  mutate(
    ind_Matr_EM_18_JENKS = 
           case_when(Ind_Matr_EM_15a17_2018 >= 100 ~ "Meta ODS atingida",
                     Ind_Matr_EM_15a17_2018 < 100                                    & Ind_Matr_EM_15a17_2018 >= ODS4_1_CORTES[4,]$ind_Matr_EM_18_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     Ind_Matr_EM_15a17_2018 < ODS4_1_CORTES[4,]$ind_Matr_EM_18_JENKS & Ind_Matr_EM_15a17_2018 >= ODS4_1_CORTES[3,]$ind_Matr_EM_18_JENKS ~ "Meta ODS próxima de ser atingida",
                     Ind_Matr_EM_15a17_2018 < ODS4_1_CORTES[3,]$ind_Matr_EM_18_JENKS & Ind_Matr_EM_15a17_2018 >= ODS4_1_CORTES[2,]$ind_Matr_EM_18_JENKS ~ "Meta ODS distante de ser atingida",
                     Ind_Matr_EM_15a17_2018 < ODS4_1_CORTES[2,]$ind_Matr_EM_18_JENKS & Ind_Matr_EM_15a17_2018 >= ODS4_1_CORTES[1,]$ind_Matr_EM_18_JENKS ~ "Meta ODS muito distante de ser atingida"
                     )
    )
    
   


ODS4_1_final$ind_Matr_EM_18_JENKS <- factor(ODS4_1_final$ind_Matr_EM_18_JENKS, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))



ODS4_1_SUMARIOgeral <- ODS4_1_final %>%
  group_by(`Bioma 1`, `Tipologia Veiga (2002)`, ind_Matr_EM_18_JENKS) %>%
  summarise(contagem = n())

```

```{r ODS4_1_JOIN SHP, message=FALSE, warning=FALSE, include=FALSE}
# Juntando o shape e a tabela
SHP_Mun_join_4_1 <- SHP_Municipios %>%
  left_join(., ODS4_1_final, by = "COD")

```


<br>

<br>


O mapa abaixo mostra a distribuição espacial geral dos dados no Brasil:

```{r ODS4_1_MAPA_NEONATAL_GERAL, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS4_1_MAPA_GERAL <- 
  SHP_Mun_join_4_1 %>%
  filter(!is.na(Ind_Matr_EM_15a17_2018)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "Ind_Matr_EM_15a17_2018", 
          title = "Índice de matrículas no EM", 
          id = "nome", 
          palette=c("#9e0142", "#f46d43", "#fee08b",  "#e6f598", "#66c2a5","#5e4fa2"),

          n=6,
          #legend.format=list(fun=function(x) paste(formatC(x, digits=0, big.mark = " ", format="f"))),
          style = "fisher") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 4.1: Matrículas no EM", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), "%"))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000)) 

ODS4_1_MAPA_GERAL

```

<br>

Abaixo, a tabela apresenta as médias de valores por região do Brasil em 2018:


```{r ODS4_1 TabelaRegiao, echo=FALSE, message=FALSE, warning=FALSE}
ODS4_1 %>%
  group_by(REGIAO) %>%
  summarise(`Matrículas no ensino médio` = scales::percent(mean(Ind_Matr_EM_15a17_2018/100, na.rm = TRUE), accuracy = 0.01)) %>%
  kbl(align = "ccrlrlrlrlrl",
    caption = "ODS Meta 4.1 - Acesso ao ensino médio (2018)*") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_footnote("*O índice de matrículas no ensino médio é dado pela porcentagem de pessoas de 15 a 17, matriculadas no ensino médio, residentes no município.")

```



## Critérios únicos (ONU e IBGE/IPEA)


**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da ONU.

* Meta ODS atingida: 100% das pessoas de 15 a 17 anos residentes no município estão matriculadas no ensino médio.
* Meta ODS muito próxima de ser atingida: De `r round(ODS4_1_CORTES[5,]$ind_Matr_EM_18_JENKS, 2)`% a `r round(ODS4_1_CORTES[4,]$ind_Matr_EM_18_JENKS, 2)`%.
* Meta ODS próxima de ser atingida: De `r round(ODS4_1_CORTES[4,]$ind_Matr_EM_18_JENKS, 2)`% a `r round(ODS4_1_CORTES[3,]$ind_Matr_EM_18_JENKS, 2)`%.
* Meta ODS distante de ser atingida: De `r round(ODS4_1_CORTES[3,]$ind_Matr_EM_18_JENKS, 2)`% a `r round(ODS4_1_CORTES[2,]$ind_Matr_EM_18_JENKS, 2)`%.
* Meta ODS muito distante de ser atingida: De `r round(ODS4_1_CORTES[2,]$ind_Matr_EM_18_JENKS, 2)`% a `r round(ODS4_1_CORTES[1,]$ind_Matr_EM_18_JENKS, 2)`%.




**Resumo por região**

```{r ODS4_1 TabelaRegiao_ONU_neo, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")
ODS4_1_final %>%
  filter(!is.na(ind_Matr_EM_18_JENKS)) %>%
  count(REGIAO = factor(REGIAO), ind_Matr_EM_18_JENKS = factor(ind_Matr_EM_18_JENKS)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = ind_Matr_EM_18_JENKS,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 4.1 - Acesso ao ensino médio (2018)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))  %>%
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2))

```




**Distribuição espacial**

```{r ODS4_1_MAPA, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS4_1_MAPA <- 
  SHP_Mun_join_4_1 %>%
  filter(!is.na(ind_Matr_EM_18_JENKS)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "ind_Matr_EM_18_JENKS", 
         title = "ODS 4.1 - Acesso ao ensino médio (2018)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS Meta 4.1 - Acesso ao ensino médio (2018)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  

ODS4_1_MAPA


```




#### Resumo por biomas

```{r ODS4_1_Tabela_Biomas_, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 4.1 ####

ODS4_1_SUMARIObioma <- ODS4_1_final %>%
  filter(!is.na(ind_Matr_EM_18_JENKS)) %>% 
  group_by(`Bioma 1`, ind_Matr_EM_18_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = ind_Matr_EM_18_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )



ODS4_1_SUMARIObioma <- ODS4_1_SUMARIObioma[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")


ODS4_1_SUMARIObioma_kbl <- kbl(ODS4_1_SUMARIObioma,
                               col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 4.1 - Acesso ao ensino médio (2018)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS4_1_SUMARIObioma_kbl

```

#### Resumo por tipologias


```{r ODS4_1_Tabela_Tipologia_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE}

ODS4_1_SUMARIOtipologia <- ODS4_1_final %>%
  group_by(`Tipologia Veiga (2002)`, ind_Matr_EM_18_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = ind_Matr_EM_18_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS4_1_SUMARIOtipologia <- ODS4_1_SUMARIOtipologia[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS4_1_SUMARIOtipologia$`Tipologia Veiga (2002)` <- factor(ODS4_1_SUMARIOtipologia$`Tipologia Veiga (2002)`, levels = c("Rural", 
                                                                                                                                          "Intermediário", 
                                                                                                                                          "Urbano"))

options(knitr.kable.NA = "Não há")

ODS4_1_SUMARIOtipologia_kbl <- kbl(ODS4_1_SUMARIOtipologia,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 4.1 - Acesso ao ensino médio (2018)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS4_1_SUMARIOtipologia_kbl

```

<br>
<br>

------

<br>
<br>

# ODS 5 - Igualdade de gênero 

**ODS 5: Alcançar a igualdade de gênero e empoderar todas as mulheres e meninas**

O quinto ODS, que trata da igualdade de gênero, será analisado utilizando a meta 5.5, que trata da participação de mulheres e igualdade de oportunidades em posições de liderança. Como indicador de referência tem-se a proporção de mulheres eleitas para mandato legislativo municipal em 2016.

* Meta 5.5
  + **ONU**: Garantir a participação plena e efetiva das mulheres e a igualdade de oportunidades para a liderança em todos os níveis de tomada de decisão na vida política, econômica e pública. 
  + **IBGE/IPEA**: Garantir a participação plena e efetiva das mulheres e a igualdade de oportunidades para a liderança em todos os níveis de tomada de decisão na esfera pública, em suas dimensões política e econômica, considerando as intersecções com raça, etnia, idade, deficiência, orientação sexual, identidade de gênero, territorialidade, cultura, religião e nacionalidade, em especial para as mulheres do campo, da floresta, das águas e das periferias urbanas.
  
Uma vez que não há na meta a determinação de cortes para o cumprimento do objetivo específico e, legalmente, o Brasil não possui a determinação de cotas mínimas de mulheres eleitas, optou-se por adotar o mesmo parâmetro dado pela [Lei 9.504/1997](http://www.planalto.gov.br/ccivil_03/leis/l9504.htm) relativo à paridade de gênero nas candidaturas, sendo considerado nesta análise que a meta foi cumprida quando a proporção de mulheres eleitas foi superior a 30%.
  


```{r ONU5_5_Tabelas, message=FALSE, warning=FALSE, include=FALSE}

ODS5_5 <- read_excel("data/ODS_Bases_consolidadas/ODS5_Indicador_551b_TSE_eleicoes_vereadores_08_12_16_genero_v28042019.xlsx", 
    col_types = c("text", "text", "text",        "text", "text", "numeric", "text",     "text", "numeric", "numeric", "numeric",        "numeric", "numeric", "numeric",        "numeric", "numeric", "numeric",        "numeric", "numeric", "numeric",        "numeric")) %>%
  mutate(REGIAO = case_when(uf == "AC" ~ "Norte",
                            uf == "AP" ~ "Norte",
                            uf == "AM" ~ "Norte",
                            uf == "PA" ~ "Norte",
                            uf == "RO" ~ "Norte",
                            uf == "RR" ~ "Norte",
                            uf == "TO" ~ "Norte",
                            
                            uf == "AL" ~ "Nordeste",
                            uf == "BA" ~ "Nordeste",
                            uf == "CE" ~ "Nordeste",
                            uf == "MA" ~ "Nordeste",
                            uf == "PB" ~ "Nordeste",
                            uf == "PI" ~ "Nordeste",
                            uf == "PE" ~ "Nordeste",
                            uf == "RN" ~ "Nordeste",
                            uf == "SE" ~ "Nordeste",
                            
                            uf == "DF" ~ "Centro-Oeste",
                            uf == "GO" ~ "Centro-Oeste",
                            uf == "MT" ~ "Centro-Oeste",
                            uf == "MS" ~ "Centro-Oeste",
                            
                            uf == "ES" ~ "Sudeste",
                            uf == "MG" ~ "Sudeste",
                            uf == "RJ" ~ "Sudeste",
                            uf == "SP" ~ "Sudeste",
                            
                            uf == "PR" ~ "Sul",
                            uf == "RS" ~ "Sul",
                            uf == "SC" ~ "Sul"))



names(ODS5_5)[1] <- "COD"

```

```{r ODS5_5_CalculoCategorias, message=FALSE, warning=FALSE, include=FALSE}

ODS5_5_CORTES <- ODS5_5 %>% 
  summarise(Pct_fem_16_QUARTIL = quantile(ODS5_5[ODS5_5$Pct_fem_16 < 30,]$`Pct_fem_16`, c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE), 
            Pct_fem_16_JENKS = BAMMtools::getJenksBreaks(ODS5_5[ODS5_5$Pct_fem_16 < 30,]$`Pct_fem_16`, 5),
           )
            
 
ODS5_5_final <- ODS5_5 %>%
  mutate(
    Pct_fem_16_JENKS = 
           case_when(Pct_fem_16 >=30 ~ "Meta ODS atingida",
                     Pct_fem_16 < 30                                 & Pct_fem_16 >= ODS5_5_CORTES[4,]$Pct_fem_16_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     Pct_fem_16 < ODS5_5_CORTES[4,]$Pct_fem_16_JENKS & Pct_fem_16 >= ODS5_5_CORTES[3,]$Pct_fem_16_JENKS ~ "Meta ODS próxima de ser atingida",
                     Pct_fem_16 < ODS5_5_CORTES[3,]$Pct_fem_16_JENKS & Pct_fem_16 >= ODS5_5_CORTES[2,]$Pct_fem_16_JENKS ~ "Meta ODS distante de ser atingida",
                     Pct_fem_16 < ODS5_5_CORTES[2,]$Pct_fem_16_JENKS & Pct_fem_16 >= ODS5_5_CORTES[1,]$Pct_fem_16_JENKS ~ "Meta ODS muito distante de ser atingida"
                     )
    )
    
   


ODS5_5_final$Pct_fem_16_JENKS <- factor(ODS5_5_final$Pct_fem_16_JENKS, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))



ODS5_5_SUMARIOgeral <- ODS5_5_final %>%
  group_by(`Bioma 1`, `Tipologia Veiga (2002)`, Pct_fem_16_JENKS) %>%
  summarise(contagem = n())

```

```{r ODS5_5_JOIN SHP, message=FALSE, warning=FALSE, include=FALSE}
# Juntando o shape e a tabela
SHP_Mun_join_5_5 <- SHP_Municipios %>%
  left_join(., ODS5_5_final, by = "COD")

```


<br>

<br>


O mapa abaixo mostra a distribuição espacial geral dos dados no Brasil:

```{r ODS5_5_MAPA_NEONATAL_GERAL, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS5_5_MAPA_GERAL <- 
  SHP_Mun_join_5_5 %>%
  filter(!is.na(Pct_fem_16)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "Pct_fem_16", 
          title = "% de mulheres eleitas", 
          id = "nome", 
          palette=c("#9e0142", "#f46d43", "#fee08b",  "#e6f598", "#66c2a5","#5e4fa2"),

          n=6,
          #legend.format=list(fun=function(x) paste(formatC(x, digits=0, big.mark = " ", format="f"))),
          style = "fisher") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 5.5: Vereadoras eleitas (2016)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), "%"))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000)) 

ODS5_5_MAPA_GERAL

```

<br>
<br>

Abaixo, a tabela apresenta as médias de valores por região do Brasil em 2016:


```{r ODS5_5 TabelaRegiao, echo=FALSE, message=FALSE, warning=FALSE}

ODS5_5 %>%
  group_by(REGIAO) %>%
  summarise(`% de vereadoras eleitas em 2016` = scales::percent(mean(Pct_fem_16/100, na.rm = TRUE), accuracy = 0.01)) %>%
  kbl(align = "ccrlrlrlrlrl",
    caption = "ODS Meta 5.5 - Vereadoras eleitas (2016)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) 

```



## Critérios únicos (ONU e IBGE/IPEA)


**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da ONU.

* Meta ODS atingida: Ao menos 30% de cadeiras ocupadas por mulheres no legislativo municipal.
* Meta ODS muito próxima de ser atingida: De `r round(ODS5_5_CORTES[5,]$Pct_fem_16_JENKS, 2)`% a `r round(ODS5_5_CORTES[4,]$Pct_fem_16_JENKS, 2)`% .
* Meta ODS próxima de ser atingida: De `r round(ODS5_5_CORTES[4,]$Pct_fem_16_JENKS, 2)`% a `r round(ODS5_5_CORTES[3,]$Pct_fem_16_JENKS, 2)`%.
* Meta ODS distante de ser atingida: De `r round(ODS5_5_CORTES[3,]$Pct_fem_16_JENKS, 2)`% a `r round(ODS5_5_CORTES[2,]$Pct_fem_16_JENKS, 2)`%.
* Meta ODS muito distante de ser atingida: De `r round(ODS5_5_CORTES[2,]$Pct_fem_16_JENKS, 2)`% a `r round(ODS5_5_CORTES[1,]$Pct_fem_16_JENKS, 2)`%.




**Resumo por região**

```{r ODS5_5 TabelaRegiao_ONU_neo, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")
ODS5_5_final %>%
  filter(!is.na(Pct_fem_16_JENKS)) %>%
  count(REGIAO = factor(REGIAO), Pct_fem_16_JENKS = factor(Pct_fem_16_JENKS)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = Pct_fem_16_JENKS,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 5.5 - Vereadoras eleitas (2016)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2))

```




**Distribuição espacial**

```{r ODS5_5_MAPA_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS5_5_MAPA <- 
  SHP_Mun_join_5_5 %>%
  filter(!is.na(Pct_fem_16_JENKS)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "Pct_fem_16_JENKS", 
         title = "ODS 5.5 - % de vereadoras eleitas (2016)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS Meta 5.5 - Mulheres eleitas no \nlegislativo municipal (2016)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          #legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))
          ) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  

ODS5_5_MAPA


```




#### Resumo por biomas

```{r ODS5_5_Tabela_Biomas_, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 5_5 ####

ODS5_5_SUMARIObioma <- ODS5_5_final %>%
  filter(!is.na(Pct_fem_16_JENKS)) %>% 
  group_by(`Bioma 1`, Pct_fem_16_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = Pct_fem_16_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )



ODS5_5_SUMARIObioma <- ODS5_5_SUMARIObioma[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")


ODS5_5_SUMARIObioma_kbl <- kbl(ODS5_5_SUMARIObioma,
                               col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 5.5 - Vereadoras eleitas (2016)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS5_5_SUMARIObioma_kbl

```

#### Resumo por tipologias


```{r ODS5_5_Tabela_Tipologia_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE}

ODS5_5_SUMARIOtipologia <- ODS5_5_final %>%
  group_by(`Tipologia Veiga (2002)`, Pct_fem_16_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = Pct_fem_16_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS5_5_SUMARIOtipologia <- ODS5_5_SUMARIOtipologia[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS5_5_SUMARIOtipologia$`Tipologia Veiga (2002)` <- factor(ODS5_5_SUMARIOtipologia$`Tipologia Veiga (2002)`, levels = c("Rural", "Intermediário", "Urbano"))

options(knitr.kable.NA = "Não há")

ODS5_5_SUMARIOtipologia_kbl <- kbl(ODS5_5_SUMARIOtipologia,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 5.5 - Vereadoras eleitas (2016)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS5_5_SUMARIOtipologia_kbl

```

<br>
<br>

------

<br>
<br>


# ODS 6 - Água potável e saneamento 


**ODS 6: Assegurar a disponibilidade e gestão sustentável da água e saneamento para todas e todos**

O sexto ODS, que trata da temática do acesso a água potável e saneamento, será analisado utilizando a meta 6.1, que trata do acesso à água própria para o consumo humano, fazendo uso do indicador de porcentagem da população municipal atendida por fontes seguras de abastecimento de água (rede de abastecimento).

* Meta 6.1
  + **ONU**: Até 2030, alcançar o acesso universal e equitativo a água potável e segura para todos. 
  + **IBGE/IPEA**: Até 2030, alcançar o acesso universal e equitativo à água para consumo humano, segura e acessível para todas e todos.
  
Uma vez que não há na meta a determinação de corte específico para o cumprimento do objetivo, será adotado como municípios que atingiram a meta aqueles que apresentaram no mínimo 99% de atendimento no ano de 2016.
  


```{r ONU6_1_Tabelas, message=FALSE, warning=FALSE, include=FALSE}

ODS6_1 <- read_excel("data/ODS_Bases_consolidadas/ODS6_Indicador_6_abast_agua.xlsx", 
    col_types = c("text", "text", "text", "text", "text", "numeric", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric")) %>%
  mutate(REGIAO = case_when(uf == "AC" ~ "Norte",
                            uf == "AP" ~ "Norte",
                            uf == "AM" ~ "Norte",
                            uf == "PA" ~ "Norte",
                            uf == "RO" ~ "Norte",
                            uf == "RR" ~ "Norte",
                            uf == "TO" ~ "Norte",
                            
                            uf == "AL" ~ "Nordeste",
                            uf == "BA" ~ "Nordeste",
                            uf == "CE" ~ "Nordeste",
                            uf == "MA" ~ "Nordeste",
                            uf == "PB" ~ "Nordeste",
                            uf == "PI" ~ "Nordeste",
                            uf == "PE" ~ "Nordeste",
                            uf == "RN" ~ "Nordeste",
                            uf == "SE" ~ "Nordeste",
                            
                            uf == "DF" ~ "Centro-Oeste",
                            uf == "GO" ~ "Centro-Oeste",
                            uf == "MT" ~ "Centro-Oeste",
                            uf == "MS" ~ "Centro-Oeste",
                            
                            uf == "ES" ~ "Sudeste",
                            uf == "MG" ~ "Sudeste",
                            uf == "RJ" ~ "Sudeste",
                            uf == "SP" ~ "Sudeste",
                            
                            uf == "PR" ~ "Sul",
                            uf == "RS" ~ "Sul",
                            uf == "SC" ~ "Sul"))



names(ODS6_1)[1] <- "COD"

```

```{r ODS6_1_CalculoCategorias, message=FALSE, warning=FALSE, include=FALSE}

ODS6_1_CORTES <- ODS6_1 %>% 
  summarise(Pct_abastagua_2016_QUARTIL = quantile(ODS6_1[ODS6_1$Pct_Pop_abast_agua_2016 < 99,]$`Pct_Pop_abast_agua_2016`, c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE), 
            Pct_abastagua_2016_JENKS = BAMMtools::getJenksBreaks(ODS6_1[ODS6_1$Pct_Pop_abast_agua_2016 < 99,]$`Pct_Pop_abast_agua_2016`, 5),
           )
            
 
ODS6_1_final <- ODS6_1 %>%
  mutate(
    Pct_abastagua_2016_JENKS = 
           case_when(Pct_Pop_abast_agua_2016 >= 99 ~ "Meta ODS atingida",
                     Pct_Pop_abast_agua_2016 < 99                                         & Pct_Pop_abast_agua_2016 >= ODS6_1_CORTES[4,]$Pct_abastagua_2016_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     Pct_Pop_abast_agua_2016 < ODS6_1_CORTES[4,]$Pct_abastagua_2016_JENKS & Pct_Pop_abast_agua_2016 >= ODS6_1_CORTES[3,]$Pct_abastagua_2016_JENKS ~ "Meta ODS próxima de ser atingida",
                     Pct_Pop_abast_agua_2016 < ODS6_1_CORTES[3,]$Pct_abastagua_2016_JENKS & Pct_Pop_abast_agua_2016 >= ODS6_1_CORTES[2,]$Pct_abastagua_2016_JENKS ~ "Meta ODS distante de ser atingida",
                     Pct_Pop_abast_agua_2016 < ODS6_1_CORTES[2,]$Pct_abastagua_2016_JENKS & Pct_Pop_abast_agua_2016 >= ODS6_1_CORTES[1,]$Pct_abastagua_2016_JENKS ~ "Meta ODS muito distante de ser atingida"
                     )
    )
    
   


ODS6_1_final$Pct_abastagua_2016_JENKS <- factor(ODS6_1_final$Pct_abastagua_2016_JENKS, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))



ODS6_1_SUMARIOgeral <- ODS6_1_final %>%
  group_by(`Bioma 1`, `Tipologia Veiga (2002)`, Pct_abastagua_2016_JENKS) %>%
  summarise(contagem = n())

```

```{r ODS6_1_JOIN SHP, message=FALSE, warning=FALSE, include=FALSE}
# Juntando o shape e a tabela
SHP_Mun_join_6_1 <- SHP_Municipios %>%
  left_join(., ODS6_1_final, by = "COD")

```


<br>

<br>


O mapa abaixo mostra a distribuição espacial geral dos dados no Brasil:

```{r ODS6_1_MAPA_NEONATAL_GERAL, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS6_1_MAPA_GERAL <- 
  SHP_Mun_join_6_1 %>%
  filter(!is.na(Pct_Pop_abast_agua_2016)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "Pct_Pop_abast_agua_2016", 
          title = "% de pessoas com abastecimento \nde água (2016)", 
          id = "nome", 
          palette=c("#9e0142", "#f46d43", "#fee08b",  "#e6f598", "#66c2a5","#5e4fa2"),

          n=6,
          #legend.format=list(fun=function(x) paste(formatC(x, digits=0, big.mark = " ", format="f"))),
          style = "fisher") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 6.1: Abastecimento de água (2016)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), "%"))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000)) 

ODS6_1_MAPA_GERAL


```

<br>
<br>

Abaixo, a tabela apresenta as médias de valores por região do Brasil em 2016:


```{r ODS6_1 TabelaRegiao, echo=FALSE, message=FALSE, warning=FALSE}

ODS6_1 %>%
  group_by(REGIAO) %>%
  summarise(`% de pessoas atendidas por fontes seguras de abastecimento de água` = scales::percent(mean(Pct_Pop_abast_agua_2016/100, na.rm = TRUE), accuracy = 0.01)) %>%
  kbl(align = "ccrlrlrlrlrl",
    caption = "ODS Meta 6.1 - Abastecimento de água (2016)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) 

```

<br>
<br>

## Critérios únicos (ONU e IBGE/IPEA)


**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da ONU.

* Meta ODS atingida: 99% a 100% da população municipal atendida por fontes seguras de abastecimento de água (rede de abastecimento).
* Meta ODS muito próxima de ser atingida: De `r round(ODS6_1_CORTES[5,]$Pct_abastagua_2016_JENKS, 2)`% a `r round(ODS6_1_CORTES[4,]$Pct_abastagua_2016_JENKS, 2)`% .
* Meta ODS próxima de ser atingida: De `r round(ODS6_1_CORTES[4,]$Pct_abastagua_2016_JENKS, 2)`% a `r round(ODS6_1_CORTES[3,]$Pct_abastagua_2016_JENKS, 2)`%.
* Meta ODS distante de ser atingida: De `r round(ODS6_1_CORTES[3,]$Pct_abastagua_2016_JENKS, 2)`% a `r round(ODS6_1_CORTES[2,]$Pct_abastagua_2016_JENKS, 2)`%.
* Meta ODS muito distante de ser atingida: De `r round(ODS6_1_CORTES[2,]$Pct_abastagua_2016_JENKS, 2)`% a `r round(ODS6_1_CORTES[1,]$Pct_abastagua_2016_JENKS, 2)`%.




**Resumo por região**

```{r ODS6_1 TabelaRegiao_ONU_neo, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")
ODS6_1_final %>%
  filter(!is.na(Pct_abastagua_2016_JENKS)) %>%
  count(REGIAO = factor(REGIAO), Pct_abastagua_2016_JENKS = factor(Pct_abastagua_2016_JENKS)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = Pct_abastagua_2016_JENKS,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 6.1 - Abastecimento de água (2016)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2))

```




**Distribuição espacial**

```{r ODS6_1_MAPA_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS6_1_MAPA <- 
  SHP_Mun_join_6_1 %>%
  filter(!is.na(Pct_abastagua_2016_JENKS)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "Pct_abastagua_2016_JENKS", 
         title = "ODS 6.1 - % de pessoas com \nabastecimento de água (2016)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS Meta 6.1 - Abastecimento de água (2016)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          #legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))
          ) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  

ODS6_1_MAPA


```




#### Resumo por biomas

```{r ODS6_1_Tabela_Biomas_, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 6_1 ####

ODS6_1_SUMARIObioma <- ODS6_1_final %>%
  filter(!is.na(Pct_abastagua_2016_JENKS)) %>% 
  group_by(`Bioma 1`, Pct_abastagua_2016_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = Pct_abastagua_2016_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )



ODS6_1_SUMARIObioma <- ODS6_1_SUMARIObioma[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")


ODS6_1_SUMARIObioma_kbl <- kbl(ODS6_1_SUMARIObioma,
                               col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 6.1 - Abastecimento de água (2016)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS6_1_SUMARIObioma_kbl

```

#### Resumo por tipologias


```{r ODS6_1_Tabela_Tipologia_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE}

ODS6_1_SUMARIOtipologia <- ODS6_1_final %>%
  group_by(`Tipologia Veiga (2002)`, Pct_abastagua_2016_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = Pct_abastagua_2016_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS6_1_SUMARIOtipologia <- ODS6_1_SUMARIOtipologia[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS6_1_SUMARIOtipologia$`Tipologia Veiga (2002)` <- factor(ODS6_1_SUMARIOtipologia$`Tipologia Veiga (2002)`, levels = c("Rural", "Intermediário", "Urbano"))

options(knitr.kable.NA = "Não há")

ODS6_1_SUMARIOtipologia_kbl <- kbl(ODS6_1_SUMARIOtipologia,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 6.1 - Abastecimento de água (2016)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS6_1_SUMARIOtipologia_kbl

```

<br>
<br>

------

<br>
<br>


# ODS 8 - Trabalho decente e crescimento econômico 


**ODS 8: Promover o crescimento econômico sustentado, inclusivo e sustentável, emprego pleno e produtivo, e trabalho decente para todos e todas**

O oitavo ODS, que trata do trabalho e crescimento econômico, será analisado utilizando duas metas, a 8.1, com indicador de taxa de crescimento anual entre 2010 e 2016 e a meta 8.2, com a taxa de crescimento anual do PIB por pessoa ocupada.

* Meta 8.1
  + **ONU**: Sustentar o crescimento econômico per capita, de acordo com as circunstâncias nacionais e, em particular, pelo menos um crescimento anual de 7% do produto interno bruto nos países de menor desenvolvimento relativo. 
  + **IBGE/IPEA**: Registrar um crescimento econômico per capita anual médio de 1,6% entre 2016 e 2018; e de 2,55% entre 2019 e 2030.
  

* Meta 8.2
  + **ONU**: Atingir níveis mais elevados de produtividade das economias, por meio da diversificação, modernização tecnológica e inovação, inclusive por meio de um foco em setores de alto valor agregado e intensivos em mão-de-obra.
  + **IBGE/IPEA**: Atingir níveis mais elevados de produtividade, por meio da diversificação e com agregação de valor, modernização tecnológica, inovação, gestão, e qualificação do trabalhador; com foco em setores intensivos em mão-de-obra.
  


```{r ONU8_1_Tabelas, message=FALSE, warning=FALSE, include=FALSE}

ODS8_1 <- read_excel("data/ODS_Bases_consolidadas/ODS8_Indicador_8_1_1_PIB_per_capita.xlsx", 
    col_types = c("text", "text", "text", "text", "text", "numeric", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric")) %>%
  mutate(REGIAO = case_when(uf == "AC" ~ "Norte",
                            uf == "AP" ~ "Norte",
                            uf == "AM" ~ "Norte",
                            uf == "PA" ~ "Norte",
                            uf == "RO" ~ "Norte",
                            uf == "RR" ~ "Norte",
                            uf == "TO" ~ "Norte",
                            
                            uf == "AL" ~ "Nordeste",
                            uf == "BA" ~ "Nordeste",
                            uf == "CE" ~ "Nordeste",
                            uf == "MA" ~ "Nordeste",
                            uf == "PB" ~ "Nordeste",
                            uf == "PI" ~ "Nordeste",
                            uf == "PE" ~ "Nordeste",
                            uf == "RN" ~ "Nordeste",
                            uf == "SE" ~ "Nordeste",
                            
                            uf == "DF" ~ "Centro-Oeste",
                            uf == "GO" ~ "Centro-Oeste",
                            uf == "MT" ~ "Centro-Oeste",
                            uf == "MS" ~ "Centro-Oeste",
                            
                            uf == "ES" ~ "Sudeste",
                            uf == "MG" ~ "Sudeste",
                            uf == "RJ" ~ "Sudeste",
                            uf == "SP" ~ "Sudeste",
                            
                            uf == "PR" ~ "Sul",
                            uf == "RS" ~ "Sul",
                            uf == "SC" ~ "Sul"),
         Tx_cres_anual_2010_2016 = Tx_cres_anual_2010_2016*100
         )

names(ODS8_1)[1] <- "COD"




ODS8_2 <- read_excel("data/ODS_Bases_consolidadas/ODS8_Indicador_8_2_1_PIB_pessoa_ocupada.xlsx", 
    col_types = c("text", "text", "text", "text", "text", "numeric", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric")) %>%
  mutate(REGIAO = case_when(uf == "AC" ~ "Norte",
                            uf == "AP" ~ "Norte",
                            uf == "AM" ~ "Norte",
                            uf == "PA" ~ "Norte",
                            uf == "RO" ~ "Norte",
                            uf == "RR" ~ "Norte",
                            uf == "TO" ~ "Norte",
                            
                            uf == "AL" ~ "Nordeste",
                            uf == "BA" ~ "Nordeste",
                            uf == "CE" ~ "Nordeste",
                            uf == "MA" ~ "Nordeste",
                            uf == "PB" ~ "Nordeste",
                            uf == "PI" ~ "Nordeste",
                            uf == "PE" ~ "Nordeste",
                            uf == "RN" ~ "Nordeste",
                            uf == "SE" ~ "Nordeste",
                            
                            uf == "DF" ~ "Centro-Oeste",
                            uf == "GO" ~ "Centro-Oeste",
                            uf == "MT" ~ "Centro-Oeste",
                            uf == "MS" ~ "Centro-Oeste",
                            
                            uf == "ES" ~ "Sudeste",
                            uf == "MG" ~ "Sudeste",
                            uf == "RJ" ~ "Sudeste",
                            uf == "SP" ~ "Sudeste",
                            
                            uf == "PR" ~ "Sul",
                            uf == "RS" ~ "Sul",
                            uf == "SC" ~ "Sul"),
         Tx_cres_anual_2010_2016 = Tx_cres_anual_2010_2016*100)

names(ODS8_2)[1] <- "COD"



```

```{r ODS8_1_CalculoCategorias, message=FALSE, warning=FALSE, include=FALSE}

ODS8_1_CORTES <- ODS8_1 %>% 
  summarise(Tx_cresanual_ppc_ONU_QUARTIL = quantile(ODS8_1[ODS8_1$Tx_cres_anual_2010_2016 < 7,]$`Tx_cres_anual_2010_2016`, c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE), 
            
            Tx_cresanual_ppc_ONU_JENKS = BAMMtools::getJenksBreaks(ODS8_1[ODS8_1$Tx_cres_anual_2010_2016 < 7,]$`Tx_cres_anual_2010_2016`, 5),
            
            Tx_cresanual_ppc_IBGE_QUARTIL = quantile(ODS8_1[ODS8_1$Tx_cres_anual_2010_2016 < 1.6,]$`Tx_cres_anual_2010_2016`, c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE), 
            Tx_cresanual_ppc_IBGE_JENKS = BAMMtools::getJenksBreaks(ODS8_1[ODS8_1$Tx_cres_anual_2010_2016 < 1.6,]$`Tx_cres_anual_2010_2016`, 5),
           )
            
 
ODS8_1_final <- ODS8_1 %>%
  mutate(
    Tx_cresanual_ppc_ONU_JENKS = 
           case_when(Tx_cres_anual_2010_2016 >= 7 ~ "Meta ODS atingida",
                     Tx_cres_anual_2010_2016 < 7                                            & Tx_cres_anual_2010_2016 >= ODS8_1_CORTES[4,]$Tx_cresanual_ppc_ONU_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     Tx_cres_anual_2010_2016 < ODS8_1_CORTES[4,]$Tx_cresanual_ppc_ONU_JENKS & Tx_cres_anual_2010_2016 >= ODS8_1_CORTES[3,]$Tx_cresanual_ppc_ONU_JENKS ~ "Meta ODS próxima de ser atingida",
                     Tx_cres_anual_2010_2016 < ODS8_1_CORTES[3,]$Tx_cresanual_ppc_ONU_JENKS & Tx_cres_anual_2010_2016 >= ODS8_1_CORTES[2,]$Tx_cresanual_ppc_ONU_JENKS ~ "Meta ODS distante de ser atingida",
                     Tx_cres_anual_2010_2016 < ODS8_1_CORTES[2,]$Tx_cresanual_ppc_ONU_JENKS & Tx_cres_anual_2010_2016 >= ODS8_1_CORTES[1,]$Tx_cresanual_ppc_ONU_JENKS ~ "Meta ODS muito distante de ser atingida"
                     ),
    Tx_cresanual_ppc_IBGE_JENKS = 
           case_when(Tx_cres_anual_2010_2016 >= 1.6 ~ "Meta ODS atingida",
                     Tx_cres_anual_2010_2016 < 1.6                                         & Tx_cres_anual_2010_2016 >= ODS8_1_CORTES[4,]$Tx_cresanual_ppc_IBGE_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     Tx_cres_anual_2010_2016 < ODS8_1_CORTES[4,]$Tx_cresanual_ppc_IBGE_JENKS & Tx_cres_anual_2010_2016 >= ODS8_1_CORTES[3,]$Tx_cresanual_ppc_IBGE_JENKS ~ "Meta ODS próxima de ser atingida",
                     Tx_cres_anual_2010_2016 < ODS8_1_CORTES[3,]$Tx_cresanual_ppc_IBGE_JENKS & Tx_cres_anual_2010_2016 >= ODS8_1_CORTES[2,]$Tx_cresanual_ppc_IBGE_JENKS ~ "Meta ODS distante de ser atingida",
                     Tx_cres_anual_2010_2016 < ODS8_1_CORTES[2,]$Tx_cresanual_ppc_IBGE_JENKS & Tx_cres_anual_2010_2016 >= ODS8_1_CORTES[1,]$Tx_cresanual_ppc_IBGE_JENKS ~ "Meta ODS muito distante de ser atingida"
                     )
    
    )
    
   


ODS8_1_final$Tx_cresanual_ppc_ONU_JENKS <- factor(ODS8_1_final$Tx_cresanual_ppc_ONU_JENKS, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))


ODS8_1_final$Tx_cresanual_ppc_IBGE_JENKS <- factor(ODS8_1_final$Tx_cresanual_ppc_IBGE_JENKS, levels = c("Meta ODS atingida",
                                                                                              "Meta ODS muito próxima de ser atingida",
                                                                                              "Meta ODS próxima de ser atingida",
                                                                                              "Meta ODS distante de ser atingida",
                                                                                              "Meta ODS muito distante de ser atingida"))

ODS8_1_SUMARIOgeral <- ODS8_1_final %>%
  group_by(`Bioma 1`, `Tipologia Veiga (2002)`, Tx_cresanual_ppc_ONU_JENKS, Tx_cresanual_ppc_IBGE_JENKS) %>%
  summarise(contagem = n())

```

```{r ODS8_1_JOIN SHP, message=FALSE, warning=FALSE, include=FALSE}
# Juntando o shape e a tabela
SHP_Mun_join_8_1 <- SHP_Municipios %>%
  left_join(., ODS8_1_final, by = "COD")

```


<br>

<br>


O mapa abaixo mostra a distribuição espacial geral dos dados no Brasil:

```{r ODS8_1_MAPA_NEONATAL_GERAL, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS8_1_MAPA_GERAL <- 
  SHP_Mun_join_8_1 %>%
  filter(!is.na(Tx_cres_anual_2010_2016)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "Tx_cres_anual_2010_2016", 
          title = "Crescimento do PIB per capita ao ano", 
          id = "nome", 
          palette=c("#9e0142", "#f46d43", "#fee08b",  "#e6f598", "#66c2a5","#5e4fa2"),

          n=6,
          #legend.format=list(fun=function(x) paste(formatC(x, digits=0, big.mark = " ", format="f"))),
          style = "fisher") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 8.1: PIB per capita a.a.", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), "%"))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000)) 

ODS8_1_MAPA_GERAL


```

<br>
<br>

Abaixo, a tabela apresenta as médias de valores por região do Brasil em 2016:


```{r ODS8_1 TabelaRegiao, echo=FALSE, message=FALSE, warning=FALSE}

ODS8_1 %>%
  group_by(REGIAO) %>%
  summarise(`Tx. de crescimento anual do PIB entre 2010 e 2016` = scales::percent(mean(Tx_cres_anual_2010_2016/100, na.rm = TRUE), accuracy = 0.01)) %>%
  kbl(align = "ccrlrlrlrlrl",
    caption = "ODS Meta 8.1 - Tx. média de crescimento anual do PIB (2010-2016)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) 

```



## Critérios ONU


**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da ONU.

* Meta ODS atingida: Crescimento anual de ao menos 7% do produto interno bruto.
* Meta ODS muito próxima de ser atingida: Crescimento de `r round(ODS8_1_CORTES[5,]$Tx_cresanual_ppc_ONU_JENKS, 2)`% a `r round(ODS8_1_CORTES[4,]$Tx_cresanual_ppc_ONU_JENKS, 2)`% .
* Meta ODS próxima de ser atingida: Crescimento de `r round(ODS8_1_CORTES[4,]$Tx_cresanual_ppc_ONU_JENKS, 2)`% a `r round(ODS8_1_CORTES[3,]$Tx_cresanual_ppc_ONU_JENKS, 2)`%.
* Meta ODS distante de ser atingida: Crescimento de `r round(ODS8_1_CORTES[3,]$Tx_cresanual_ppc_ONU_JENKS, 2)`% a `r round(ODS8_1_CORTES[2,]$Tx_cresanual_ppc_ONU_JENKS, 2)`%.
* Meta ODS muito distante de ser atingida: Crescimento de `r round(ODS8_1_CORTES[2,]$Tx_cresanual_ppc_ONU_JENKS, 2)`% a `r round(ODS8_1_CORTES[1,]$Tx_cresanual_ppc_ONU_JENKS, 2)`%.




**Resumo por região**

```{r ODS8_1 TabelaRegiao_ONU, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")
ODS8_1_final %>%
  filter(!is.na(Tx_cresanual_ppc_ONU_JENKS)) %>%
  count(REGIAO = factor(REGIAO), Tx_cresanual_ppc_ONU_JENKS = factor(Tx_cresanual_ppc_ONU_JENKS)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = Tx_cresanual_ppc_ONU_JENKS,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 8.1 (ONU) - Tx. de crescimento anual do PIB (2010-2016)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2))

```




**Distribuição espacial**

```{r ODS8_1_MAPA_NEONATAL_ONU, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS8_1_MAPA_ONU <- 
  SHP_Mun_join_8_1 %>%
  filter(!is.na(Tx_cresanual_ppc_ONU_JENKS)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "Tx_cresanual_ppc_ONU_JENKS", 
         title = "ODS 8.1 (ONU) - Média da tx. de \ncrescimento do PIB a.a. (2010-2016)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS Meta 8.1 (ONU) - Tx. de \ncrescimento anual do PIB (2010-2016)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          #legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))
          ) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  

ODS8_1_MAPA_ONU

```

<br>

<br>


#### Resumo por biomas

```{r ODS8_1_Tabela_Biomas_ONU, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 8_1 ####

ODS8_1_SUMARIObiomaONU <- ODS8_1_final %>%
  filter(!is.na(Tx_cresanual_ppc_ONU_JENKS)) %>% 
  group_by(`Bioma 1`, Tx_cresanual_ppc_ONU_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = Tx_cresanual_ppc_ONU_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )



ODS8_1_SUMARIObiomaONU <- ODS8_1_SUMARIObiomaONU[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")


ODS8_1_SUMARIObiomaONU_kbl <- kbl(ODS8_1_SUMARIObiomaONU,
                               col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 8.1 (ONU) - Tx. de crescimento anual do PIB (2010-2016)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS8_1_SUMARIObiomaONU_kbl

```

#### Resumo por tipologias


```{r ODS8_1_Tabela_Tipologia_ONU, echo=FALSE, message=FALSE, warning=FALSE}

ODS8_1_SUMARIOtipologiaONU <- ODS8_1_final %>%
  group_by(`Tipologia Veiga (2002)`, Tx_cresanual_ppc_ONU_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = Tx_cresanual_ppc_ONU_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS8_1_SUMARIOtipologiaONU <- ODS8_1_SUMARIOtipologiaONU[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS8_1_SUMARIOtipologiaONU$`Tipologia Veiga (2002)` <- factor(ODS8_1_SUMARIOtipologiaONU$`Tipologia Veiga (2002)`, levels = c("Rural", "Intermediário", "Urbano"))

options(knitr.kable.NA = "Não há")

ODS8_1_SUMARIOtipologiaONU_kbl <- kbl(ODS8_1_SUMARIOtipologiaONU,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 8.1 - Tx. de crescimento anual do PIB (2010-2016)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS8_1_SUMARIOtipologiaONU_kbl

```

<br>
<br>

------

<br>
<br>

## Critérios IBGE/IPEA

**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta do IBGE/IPEA.

* Meta ODS atingida: Crescimento anual do produto interno bruto de ao menos 1.6%.
* Meta ODS muito próxima de ser atingida: Crescimento de `r round(ODS8_1_CORTES[5,]$Tx_cresanual_ppc_IBGE_JENKS, 2)`% a `r round(ODS8_1_CORTES[4,]$Tx_cresanual_ppc_IBGE_JENKS, 2)`% .
* Meta ODS próxima de ser atingida: Crescimento de `r round(ODS8_1_CORTES[4,]$Tx_cresanual_ppc_IBGE_JENKS, 2)`% a `r round(ODS8_1_CORTES[3,]$Tx_cresanual_ppc_IBGE_JENKS, 2)`%.
* Meta ODS distante de ser atingida: Crescimento de `r round(ODS8_1_CORTES[3,]$Tx_cresanual_ppc_IBGE_JENKS, 2)`% a `r round(ODS8_1_CORTES[2,]$Tx_cresanual_ppc_IBGE_JENKS, 2)`%.
* Meta ODS muito distante de ser atingida: Crescimento de `r round(ODS8_1_CORTES[2,]$Tx_cresanual_ppc_IBGE_JENKS, 2)`% a `r round(ODS8_1_CORTES[1,]$Tx_cresanual_ppc_IBGE_JENKS, 2)`%.




**Resumo por região**

```{r ODS8_1 TabelaRegiao_IBGE, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")

ODS8_1_final %>%
  filter(!is.na(Tx_cresanual_ppc_IBGE_JENKS)) %>%
  count(REGIAO = factor(REGIAO), Tx_cresanual_ppc_IBGE_JENKS = factor(Tx_cresanual_ppc_IBGE_JENKS)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = Tx_cresanual_ppc_IBGE_JENKS,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 8.1 (IBGE) - Tx. de crescimento anual do PIB (2010-2016)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2))

```

<br>
<br>


**Distribuição espacial**

```{r ODS8_1_MAPA_NEONATAL_IBGE, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS8_1_MAPA_IBGE <- 
  SHP_Mun_join_8_1 %>%
  filter(!is.na(Tx_cresanual_ppc_IBGE_JENKS)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "Tx_cresanual_ppc_IBGE_JENKS", 
         title = "ODS 8.1 (IBGE) - Média da tx. de \ncrescimento do PIB a.a. (2010-2016)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS Meta 8.1 (IBGE) - Tx. de crescimento anual do PIB (2010-2016)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          #legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))
          ) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  

ODS8_1_MAPA_IBGE


```




#### Resumo por biomas

```{r ODS8_1_Tabela_Biomas_IBGE, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 8_1 ####

ODS8_1_SUMARIObiomaIBGE <- ODS8_1_final %>%
  filter(!is.na(Tx_cresanual_ppc_IBGE_JENKS)) %>% 
  group_by(`Bioma 1`, Tx_cresanual_ppc_IBGE_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = Tx_cresanual_ppc_IBGE_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )



ODS8_1_SUMARIObiomaIBGE <- ODS8_1_SUMARIObiomaIBGE[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")


ODS8_1_SUMARIObiomaIBGE_kbl <- kbl(ODS8_1_SUMARIObiomaIBGE,
                               col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 8.1 (IBGE) - Tx. de crescimento anual do PIB (2010-2016)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS8_1_SUMARIObiomaIBGE_kbl

```

#### Resumo por tipologias


```{r ODS8_1_Tabela_Tipologia_IBGE, echo=FALSE, message=FALSE, warning=FALSE}

ODS8_1_SUMARIOtipologiaIBGE <- ODS8_1_final %>%
  group_by(`Tipologia Veiga (2002)`, Tx_cresanual_ppc_IBGE_JENKS) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = Tx_cresanual_ppc_IBGE_JENKS, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS8_1_SUMARIOtipologiaIBGE <- ODS8_1_SUMARIOtipologiaIBGE[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS8_1_SUMARIOtipologiaIBGE$`Tipologia Veiga (2002)` <- factor(ODS8_1_SUMARIOtipologiaIBGE$`Tipologia Veiga (2002)`, levels = c("Rural", "Intermediário", "Urbano"))

options(knitr.kable.NA = "Não há")

ODS8_1_SUMARIOtipologiaIBGE_kbl <- kbl(ODS8_1_SUMARIOtipologiaIBGE,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 8.1 - Tx. de crescimento anual do PIB (2010-2016)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS8_1_SUMARIOtipologiaIBGE_kbl

```

<br>
<br>

------

<br>
<br>



# ODS 16 - Paz, justiça e instituições eficazes 

**ODS 16: Promover sociedades pacíficas e inclusivas para o desenvolvimento sustentável, proporcionar o acesso à justiça para todos e construir instituições eficazes, responsáveis e inclusivas em todos os níveis**


O ODS 16 será analisado a partir da meta 16.1, por meio da análise das taxas de mortalidade por homicídio intencional de dois grupos específicos (mulheres e pessoas negros (pretos e pardos), além dos totais. 

* Meta 16.1:
  + **ONU:** Reduzir significativamente todas as formas de violência e as taxas de mortalidade relacionadas, em todos os lugares.
  + **IBGE/IPEA:** Reduzir significativamente todas as formas de violência e as taxas de mortalidade relacionadas, em todos os lugares, inclusive com a redução de 1/3 das taxas de feminicídio e de homicídios de crianças, adolescentes, jovens, pessoas negras, indígenas, mulheres e LGBT.
 

Como a meta original da ONU não apresenta indicadores, será analisada apenas a meta determinada pelo IBGE/IPEA. Uma vez que a redução de 1/3 na taxa de mortalidade de pessoas entre minorias sociais não é um indicador absoluto,  mas relativo ao seu ano de elaboração, para fins de comparação  foi adotada a média de mortalidade de cada estado no ano de 2015, segmentada pelos dois grupos sociais analisados. 
Dessa maneira, serão considerados como municípios que já atingiram a meta aqueles que apresentarem redução superior a 33% na taxa de homicídio intencional por 100.000 habitantes de 2015 para 2017 ou que apresentarem taxa de 0% em 2017. Os demais municípios foram divididos em 4 categorias, por quebras naturais. 

É importante ressaltar três pontos metodológicos: 

- Nos casos em que a taxa de mortalidade por homicídio intencional apresentava valores nulos em ambos os anos (2015 e 2017), a meta foi considerada como atingida;

- Há uma quantidade expressiva de municípios em que a taxa de mortalidade por homicídio intencional apresentava valor nulo em 2015, mas valor não nulo em 2017. Visto que não há a possibilidade de estimar aumento ou redução percentual a partir de um valor inicial nulo, a média estadual foi adotada como linha de base (à indicação do IPEA).  

- Entre os anos de 2015 e 2017, o dado de mortalidade por violência de indígenas estava zerado para a grande maioria de municípios (aproximadamente 97%), não sendo possível distinguir se isso representa realmente ausência de ocorrências ou ausência de informações. Dessa maneira, a média estadual da taxa de mortalidade indígena ficou distorcida, inviabilizando a comparação entre os dois anos, bem como análise em relação ao cumprimento da meta ODS. Uma vez que a base utilizada para este trabalho não estabelece a distinção se os valores nulos são devido a não ocorrência ou a ausência de dados, para analisar este caso específico seria mais apropriada uma análise focal, revisitando os dados brutos. 




```{r ODS16_Tabelas, message=FALSE, warning=FALSE, include=FALSE}

ODS16_1 <- read_excel("data/ODS_Bases_consolidadas/ODS16_Indicador_16_1_1_taxa_homicidio intencional.xlsx", 
    col_types = c("text", "text", "text",  "text", "text", "numeric", "text", "text", "text", "numeric", "numeric", 
        "numeric", "numeric", "numeric","numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric","numeric")) %>%
  
  mutate(REGIAO = case_when(uf == "AC" ~ "Norte",
                            uf == "AP" ~ "Norte",
                            uf == "AM" ~ "Norte",
                            uf == "PA" ~ "Norte",
                            uf == "RO" ~ "Norte",
                            uf == "RR" ~ "Norte",
                            uf == "TO" ~ "Norte",
                            
                            uf == "AL" ~ "Nordeste",
                            uf == "BA" ~ "Nordeste",
                            uf == "CE" ~ "Nordeste",
                            uf == "MA" ~ "Nordeste",
                            uf == "PB" ~ "Nordeste",
                            uf == "PI" ~ "Nordeste",
                            uf == "PE" ~ "Nordeste",
                            uf == "RN" ~ "Nordeste",
                            uf == "SE" ~ "Nordeste",
                            
                            uf == "DF" ~ "Centro-Oeste",
                            uf == "GO" ~ "Centro-Oeste",
                            uf == "MT" ~ "Centro-Oeste",
                            uf == "MS" ~ "Centro-Oeste",
                            
                            uf == "ES" ~ "Sudeste",
                            uf == "MG" ~ "Sudeste",
                            uf == "RJ" ~ "Sudeste",
                            uf == "SP" ~ "Sudeste",
                            
                            uf == "PR" ~ "Sul",
                            uf == "RS" ~ "Sul",
                            uf == "SC" ~ "Sul")) %>%  
  
    mutate(geocodigo_ibge = case_when(
    uf == "TO" ~ str_replace(geocodigo_ibge, str_sub(geocodigo_ibge, 1, 2), "17"),
    TRUE ~ as.character(geocodigo_ibge),
  ))

names(ODS16_1)[1] <- "COD"


ODS_groupby <- ODS16_1 %>% 
  group_by(uf)

ODS_groupby <- ODS_groupby %>% 
  summarise(
    TxHomi_15_Tot_mean = mean(TxHomi_15_Tot), 
    TxHomi_15_Fem_mean = mean(TxHomi_15_Fem), 
    TxHomi_15_PrePar_mean = mean(TxHomi_15_PrePar),
    TxHomi_15_Indig_mean = mean(TxHomi_15_Indig)
    )

ODS16_ind <- ODS_groupby %>%
  mutate(TxHomi_15_Indig_mean = 
           case_when(TxHomi_15_Indig_mean < 0.1 ~ 0, TxHomi_15_Indig_mean > 0.1 ~ TxHomi_15_Indig_mean )) 


ODS16_1 <- left_join(ODS16_1, ODS16_ind, by = "uf")

ODS16_1 <- ODS16_1 %>%
  mutate(
    
    Evol_TxHomi_1517_Tot = (((TxHomi_17_Tot * 100)/TxHomi_15_Tot_mean)-100), 
    Evol_TxHomi_1517_Fem = (((TxHomi_17_Fem * 100)/TxHomi_15_Fem_mean)-100), 
    Evol_TxHomi_1517_PrePar = (((TxHomi_17_PrePar * 100)/TxHomi_15_PrePar_mean)-100), 
    Evol_TxHomi_1517_Indig = (((TxHomi_17_Indig * 100)/TxHomi_15_Indig_mean)-100),
    
    
    EvolBRUTA_TxHomi_1517_Tot = (TxHomi_17_Tot-TxHomi_15_Tot), 
    EvolBRUTA_TxHomi_1517_Fem = (TxHomi_17_Fem-TxHomi_15_Fem), 
    EvolBRUTA_TxHomi_1517_PrePar = (TxHomi_17_PrePar-TxHomi_15_PrePar), 
    EvolBRUTA_TxHomi_1517_Indig = (TxHomi_17_Indig-TxHomi_15_Indig)
    
    
  )


 

```

```{r ODS16_CalculoCategorias, message=FALSE, warning=FALSE, include=FALSE}

            
ODS16_1_CORTES <- 
  ODS16_1 %>% 
  summarise(
    Evol_TxHomi_1517_Tot_QUARTIL = quantile(ODS16_1[ODS16_1$Evol_TxHomi_1517_Tot > -33 & ODS16_1$Evol_TxHomi_1517_Tot <= 0,]$`Evol_TxHomi_1517_Tot`, c(0, 0.5, 1), na.rm = TRUE),
            Evol_TxHomi_1517_Tot_JENKS = BAMMtools::getJenksBreaks(ODS16_1[ODS16_1$Evol_TxHomi_1517_Tot > -33 & ODS16_1$Evol_TxHomi_1517_Tot <=0 & !is.na(ODS16_1$Evol_TxHomi_1517_Tot),]$`Evol_TxHomi_1517_Tot`, 3),  
            
            Evol_TxHomi_1517_Fem_QUARTIL = quantile(ODS16_1[ODS16_1$Evol_TxHomi_1517_Fem > -33 & ODS16_1$Evol_TxHomi_1517_Fem <=0,]$`Evol_TxHomi_1517_Fem`, c(0, 0.5, 1), na.rm = TRUE),
            Evol_TxHomi_1517_Fem_JENKS = BAMMtools::getJenksBreaks(ODS16_1[ODS16_1$Evol_TxHomi_1517_Fem > -33 & ODS16_1$Evol_TxHomi_1517_Fem <=0 & !is.na(ODS16_1$Evol_TxHomi_1517_Fem),]$`Evol_TxHomi_1517_Fem`, 3), 
            
            Evol_TxHomi_1517_PrePar_QUARTIL = quantile(ODS16_1[ODS16_1$Evol_TxHomi_1517_PrePar > -33 & ODS16_1$Evol_TxHomi_1517_PrePar <=0,]$`Evol_TxHomi_1517_PrePar`, c(0, 0.5,  1), na.rm = TRUE),
            Evol_TxHomi_1517_PrePar_JENKS = BAMMtools::getJenksBreaks(ODS16_1[ODS16_1$Evol_TxHomi_1517_PrePar > -33 & ODS16_1$Evol_TxHomi_1517_PrePar <=0 & !is.na(ODS16_1$Evol_TxHomi_1517_PrePar),]$`Evol_TxHomi_1517_PrePar`, 3), 
            
            
            #Evol_TxHomi_1517_Indig_QUARTIL = quantile(ODS16_1[ODS16_1$Evol_TxHomi_1517_Indig > -33 & ODS16_1$Evol_TxHomi_1517_Indig <=0,]$`Evol_TxHomi_1517_Indig`, c(0, 0.5, 1), na.rm = TRUE),
            #Evol_TxHomi_1517_Indig_JENKS = BAMMtools::getJenksBreaks(ODS16_1[ODS16_1$Evol_TxHomi_1517_Indig > -33 & ODS16_1$Evol_TxHomi_1517_Indig <=0 & !is.na(ODS16_1$Evol_TxHomi_1517_Indig),]$`Evol_TxHomi_1517_Indig`, 3)
            
            )

            
ODS16_1_CORTES_ <- 
  ODS16_1 %>% 
  summarise(
    Evol_TxHomi_1517_Tot_QUARTIL = quantile(ODS16_1[ODS16_1$Evol_TxHomi_1517_Tot >0,]$`Evol_TxHomi_1517_Tot`, c(0, 0.5, 1), na.rm = TRUE),
            Evol_TxHomi_1517_Tot_JENKS = BAMMtools::getJenksBreaks(ODS16_1[ODS16_1$Evol_TxHomi_1517_Tot >0 & !is.na(ODS16_1$Evol_TxHomi_1517_Tot),]$`Evol_TxHomi_1517_Tot`, 3),  
            
            Evol_TxHomi_1517_Fem_QUARTIL = quantile(ODS16_1[ODS16_1$Evol_TxHomi_1517_Fem >0,]$`Evol_TxHomi_1517_Fem`, c(0, 0.5, 1), na.rm = TRUE),
            Evol_TxHomi_1517_Fem_JENKS = BAMMtools::getJenksBreaks(ODS16_1[ODS16_1$Evol_TxHomi_1517_Fem >0 & !is.na(ODS16_1$Evol_TxHomi_1517_Fem),]$`Evol_TxHomi_1517_Fem`, 3), 
            
            Evol_TxHomi_1517_PrePar_QUARTIL = quantile(ODS16_1[ODS16_1$Evol_TxHomi_1517_PrePar >0,]$`Evol_TxHomi_1517_PrePar`, c(0, 0.5,  1), na.rm = TRUE),
            Evol_TxHomi_1517_PrePar_JENKS = BAMMtools::getJenksBreaks(ODS16_1[ODS16_1$Evol_TxHomi_1517_PrePar > 0 & !is.na(ODS16_1$Evol_TxHomi_1517_PrePar),]$`Evol_TxHomi_1517_PrePar`, 3), 
            
            
            #Evol_TxHomi_1517_Indig_QUARTIL = quantile(ODS16_1[ODS16_1$Evol_TxHomi_1517_Indig >0 & !is.infinite(ODS16_1$Evol_TxHomi_1517_Indig),]$`Evol_TxHomi_1517_Indig`, c(0, 0.5, 1), na.rm = TRUE),
            #Evol_TxHomi_1517_Indig_JENKS = BAMMtools::getJenksBreaks(ODS16_1[ODS16_1$Evol_TxHomi_1517_Indig > 0  & !is.infinite(ODS16_1$Evol_TxHomi_1517_Indig) & !is.na(ODS16_1$Evol_TxHomi_1517_Indig),]$`Evol_TxHomi_1517_Indig`, 3)
            
)

ODS16_1_CORTES_final <- rbind(ODS16_1_CORTES, ODS16_1_CORTES_)

#deletar linha 

ods_manter <- c(TRUE,TRUE,TRUE,FALSE,TRUE,TRUE)
            

ODS16_1_CORTES_final <- ODS16_1_CORTES_final[ods_manter,]

ODS16_1_CORTES_final[3,] <- 0


# ODS16_1_Jenks <- as.data.frame(BAMMtools::getJenksBreaks(ODS16_1[ODS16_1$p_pes_pobr_ext_ONU_2017 > 3,]$`p_pes_pobr_ext_ONU_2017`, 5))
# ODS16_1_Jenks <- bind_cols(ODS16_1_Jenks, as.data.frame(BAMMtools::getJenksBreaks(ODS16_1[ODS16_1$p_pes_pobr_ext_IBGE_2017 > 3,]$`p_pes_pobr_ext_IBGE_2017`, 5)))


#teste1 <- ODS16_1_final %>% 
  #filter(EvolCLAS_TxHomi_1517_Indig == "Meta ODS muito distante de ser atingida") %>% 
 # select(Evol_TxHomi_1517_Indig, TxHomi_17_Indig, TxHomi_15_Indig_mean, uf )


                                             
  ODS16_1_final <- ODS16_1 %>%
  mutate(EvolCLAS_TxHomi_1517_Tot = 
           case_when(Evol_TxHomi_1517_Tot <= -33 ~ "Meta ODS atingida",
                     is.na(Evol_TxHomi_1517_Tot) ~ "Meta ODS atingida",
                     
                     Evol_TxHomi_1517_Tot > -33 & Evol_TxHomi_1517_Tot <= ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_Tot_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     Evol_TxHomi_1517_Tot > ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_Tot_JENKS & Evol_TxHomi_1517_Tot <= ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_Tot_JENKS ~ "Meta ODS próxima de ser atingida",
                     Evol_TxHomi_1517_Tot > ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_Tot_JENKS & Evol_TxHomi_1517_Tot <= ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_Tot_JENKS ~ "Meta ODS distante de ser atingida",
                     Evol_TxHomi_1517_Tot > ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_Tot_JENKS & Evol_TxHomi_1517_Tot <= ODS16_1_CORTES_final[5,]$Evol_TxHomi_1517_Tot_JENKS ~ "Meta ODS muito distante de ser atingida"), 
                     
                     # Evol_TxHomi_1517_Tot > ODS16_1_CORTES_final[5,]$Evol_TxHomi_1517_Tot_JENKS ~ "Não é possível estimar a distância"
                     # 
                     # ),
         
         
         EvolCLAS_TxHomi_1517_Fem = 
           case_when(Evol_TxHomi_1517_Fem <= -33 ~ "Meta ODS atingida",
                     is.na(Evol_TxHomi_1517_Fem) ~ "Meta ODS atingida",
                     
                     Evol_TxHomi_1517_Fem > -33 & Evol_TxHomi_1517_Fem <= ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_Fem_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     Evol_TxHomi_1517_Fem > ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_Fem_JENKS & Evol_TxHomi_1517_Fem <= ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_Fem_JENKS ~ "Meta ODS próxima de ser atingida",
                     Evol_TxHomi_1517_Fem > ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_Fem_JENKS & Evol_TxHomi_1517_Fem <= ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_Fem_JENKS ~ "Meta ODS distante de ser atingida",
                     Evol_TxHomi_1517_Fem > ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_Fem_JENKS & Evol_TxHomi_1517_Fem <= ODS16_1_CORTES_final[5,]$Evol_TxHomi_1517_Fem_JENKS ~ "Meta ODS muito distante de ser atingida"),
                     
                     # Evol_TxHomi_1517_Fem > ODS16_1_CORTES_final[5,]$Evol_TxHomi_1517_Fem_JENKS ~ "Não é possível estimar a distância"
                     # 
                     # ),
                     # 
         
         EvolCLAS_TxHomi_1517_PrePar = 
           case_when(Evol_TxHomi_1517_PrePar <= -33 ~ "Meta ODS atingida",
                     is.na(Evol_TxHomi_1517_PrePar) ~ "Meta ODS atingida",
                     
                     Evol_TxHomi_1517_PrePar > -33 & Evol_TxHomi_1517_PrePar <= ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_PrePar_JENKS ~ "Meta ODS muito próxima de ser atingida",
                     Evol_TxHomi_1517_PrePar > ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_PrePar_JENKS & Evol_TxHomi_1517_PrePar <= ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_PrePar_JENKS ~ "Meta ODS próxima de ser atingida",
                     Evol_TxHomi_1517_PrePar > ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_PrePar_JENKS & Evol_TxHomi_1517_PrePar <= ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_PrePar_JENKS ~ "Meta ODS distante de ser atingida",
                     Evol_TxHomi_1517_PrePar > ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_PrePar_JENKS & Evol_TxHomi_1517_PrePar <= ODS16_1_CORTES_final[5,]$Evol_TxHomi_1517_PrePar_JENKS ~ "Meta ODS muito distante de ser atingida"))
                     
                     #Evol_TxHomi_1517_PrePar > ODS16_1_CORTES_final[5,]$Evol_TxHomi_1517_PrePar_JENKS ~ "Não é possível estimar a distância"
                     
                    # ))
         
         
  #        #EvolCLAS_TxHomi_1517_Indig = 
  #          case_when(Evol_TxHomi_1517_Indig <= -33 ~ "Meta ODS atingida",
  #                    is.na(Evol_TxHomi_1517_Indig) ~ "Meta ODS atingida",
  #                    
  #                    Evol_TxHomi_1517_Indig > -33 & Evol_TxHomi_1517_Indig <= ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_Indig_JENKS ~ "Meta ODS muito próxima de ser atingida",
  #                    Evol_TxHomi_1517_Indig > ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_Indig_JENKS & Evol_TxHomi_1517_Indig <= ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_Indig_JENKS ~ "Meta ODS próxima de ser atingida",
  #                    Evol_TxHomi_1517_Indig > ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_Indig_JENKS & Evol_TxHomi_1517_Indig <= ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_Indig_JENKS ~ "Meta ODS distante de ser atingida",
  #                    Evol_TxHomi_1517_Indig > ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_Indig_JENKS & Evol_TxHomi_1517_Indig <= ODS16_1_CORTES_final[5,]$Evol_TxHomi_1517_Indig_JENKS ~ "Meta ODS muito distante de ser atingida",
  #                    
  #                    Evol_TxHomi_1517_Indig > ODS16_1_CORTES_final[5,]$Evol_TxHomi_1517_Indig_JENKS ~ "Não é possível estimar a distância"
  #                    
  #                    )
  # )
      
                                             
                                             

ODS16_1_final$EvolCLAS_TxHomi_1517_Tot <- factor(ODS16_1_final$EvolCLAS_TxHomi_1517_Tot, levels = c("Meta ODS atingida",
                                                                                  "Meta ODS muito próxima de ser atingida",
                                                                                  "Meta ODS próxima de ser atingida",
                                                                                  "Meta ODS distante de ser atingida",
                                                                                  "Meta ODS muito distante de ser atingida"))
                                                                                  #"Não é possível estimar a distância"))

ODS16_1_final$EvolCLAS_TxHomi_1517_Fem <- factor(ODS16_1_final$EvolCLAS_TxHomi_1517_Fem, levels = c("Meta ODS atingida",
                                                                                    "Meta ODS muito próxima de ser atingida",
                                                                                    "Meta ODS próxima de ser atingida",
                                                                                    "Meta ODS distante de ser atingida",
                                                                                    "Meta ODS muito distante de ser atingida"))
                                                                                    #"Não é possível estimar a distância"))

ODS16_1_final$EvolCLAS_TxHomi_1517_PrePar <- factor(ODS16_1_final$EvolCLAS_TxHomi_1517_PrePar, levels = c("Meta ODS atingida",
                                                                                    "Meta ODS muito próxima de ser atingida",
                                                                                    "Meta ODS próxima de ser atingida",
                                                                                    "Meta ODS distante de ser atingida",
                                                                                    "Meta ODS muito distante de ser atingida"))
                                                                                    #Não é possível estimar a distância"))

# ODS16_1_final$EvolCLAS_TxHomi_1517_Indig <- factor(ODS16_1_final$EvolCLAS_TxHomi_1517_Indig, levels = c("Meta ODS atingida",
#                                                                                     "Meta ODS muito próxima de ser atingida",
#                                                                                     "Meta ODS próxima de ser atingida",
#                                                                                     "Meta ODS distante de ser atingida",
#                                                                                     "Meta ODS muito distante de ser atingida",
#                                                                                     "Não é possível estimar a distância"))



# ODS16_1_SUMARIOgeral <- ODS16_1_final %>%
#   group_by(`Bioma 1`, `Tipologia Veiga (2002)`, PobExtrIBGE_2017, PobExtrONU_2017) %>%
#   summarise(contagem = n())
```

```{r ODS16_1_JOIN SHP, message=FALSE, warning=FALSE, include=FALSE}
# Juntando o shape e a tabela
SHP_Mun_join_16_1 <- SHP_Municipios %>%
inner_join(., ODS16_1_final, by = "COD")

```


  


O mapa abaixo mostra a distribuição espacial geral dos dados no Brasil:

```{r ODS16_1_MAPA_GERAL, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS16_1_MapaTot <- 
  SHP_Mun_join_16_1 %>%
 # filter(!is.na(EvolBRUTA_TxHomi_1517_Tot)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "EvolBRUTA_TxHomi_1517_Tot", 
         title = "Diferença da taxa de homicídios \nintencionais entre 2015 e 2017", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
           colorNA = "light grey", # color of missing data
                textNA = "Não há dado disponível",
         
        breaks = c(-124, -36, 0, 12, 42, 158),
         
         style = "fixed") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS Meta 16.1: Redução da violência", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","BOTTOM"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.1)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  


ODS16_1_MapaTot


ODS16_1_MapaFEM <- 
  SHP_Mun_join_16_1 %>%
 # filter(!is.na(EvolBRUTA_TxHomi_1517_Fem)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "EvolBRUTA_TxHomi_1517_Fem", 
         title = "Diferença da taxa de homicídios \nintencionais entre 2015 e 2017", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
           colorNA = "light grey", # color of missing data
                textNA = "Não há dado disponível",
  breaks = c(-72, -19, 0, 5, 22, 115),
         
         style = "fixed") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS Meta 16.1: Redução da violência - \nHomicídios de mulheres", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","BOTTOM"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.1)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  


ODS16_1_MapaFEM


ODS16_1_MapaPrePar <- 
  SHP_Mun_join_16_1 %>%
 # filter(!is.na(EvolBRUTA_TxHomi_1517_PrePar)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "EvolBRUTA_TxHomi_1517_PrePar", 
         title = "Diferença da taxa de homicídios \nintencionais entre 2015 e 2017", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
           colorNA = "light grey", # color of missing data
                textNA = "Não há dado disponível",
  breaks = c(-145, -36, 0, 10, 39, 158), 
         style = "fixed") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS Meta 16.1: Redução da violência - \nHomicídios de pessoas negras (pretos e pardos)", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","BOTTOM"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.1)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  


ODS16_1_MapaPrePar



```

Os valores negativos representam uma redução na taxa de homicídios a cada 100 mil habitantes por município, entre os anos de 2015 e 2017. 

<br>

Abaixo, a tabela apresenta as médias de valores por região do Brasil:


```{r ODS16_1 TabelaRegiao, echo=FALSE, message=FALSE, warning=FALSE}
####Resumo por região#### 
ODS16_1_final %>%
  group_by(REGIAO) %>%
  summarise(`Homicídios totais` = round(mean(EvolBRUTA_TxHomi_1517_Tot, na.rm = TRUE), 2),
            `Homicídio de mulheres` = round(mean(EvolBRUTA_TxHomi_1517_Fem, na.rm = TRUE), 2),
            `Homicídios de pessoas negras` = round(mean(EvolBRUTA_TxHomi_1517_PrePar, na.rm = TRUE), 2),
            #`Evolução média da taxa de homocídios de indígenas` = round(mean(!is.infinite(EvolBRUTA_TxHomi_1517_Tot), na.rm = TRUE), 2)
            ) %>%
  kbl(align = "cccccc",
    caption = "ODS 16.1: Redução da violência - Diferença média da taxa de homicídios (2015 a 2017)") %>%
# kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) 


```



<br>

------

## Critérios únicos (IBGE/IPEA) - Totais


**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da ONU.

* Meta ODS atingida: Decrescimento de ao menos 33% na taxa de mortalidade por homicídio intencional de 2015 para 2017 ou taxa zerada em 2017.
* Meta ODS muito próxima de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[1,]$Evol_TxHomi_1517_Tot_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_Tot_JENKS, 2)`%.
* Meta ODS próxima de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_Tot_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_Tot_JENKS, 2)`%.
* Meta ODS distante de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_Tot_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_Tot_JENKS, 2)`%.
* Meta ODS muito distante de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_Tot_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[5,]$Evol_TxHomi_1517_Tot_JENKS, 2)`%.




**Resumo por região**

```{r ODS16_1 TabelaRegiao_TOT, echo=FALSE, message=FALSE, warning=FALSE}

options(knitr.kable.NA = "Não há")
ODS16_1_final %>%
  filter(!is.na(EvolCLAS_TxHomi_1517_Tot)) %>%
  count(REGIAO = factor(REGIAO), EvolCLAS_TxHomi_1517_Tot = factor(EvolCLAS_TxHomi_1517_Tot)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = EvolCLAS_TxHomi_1517_Tot,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 16.1: Redução da violência - Homicídios totais (2015 a 2017)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))  %>%
 add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2))

```




**Distribuição espacial**

```{r ODS16_1_MAPA_TOT, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS16_1_MAPA_total <- 
  SHP_Mun_join_16_1 %>%
  filter(!is.na(EvolCLAS_TxHomi_1517_Tot)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "EvolCLAS_TxHomi_1517_Tot", 
         title = "ODS 16.1: Redução da violência (2015 a 2017)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
         colorNA = "light grey", # color of missing data
                textNA = "Não há dado disponível",
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 16.1: Redução da violência ", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  


ODS16_1_MAPA_total


```




#### Resumo por biomas

```{r ODS16_1_Tabela_Biomas__TOT, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 16.1 ####

ODS16_1_SUMARIObioma_tot <- ODS16_1_final %>%
  filter(!is.na(EvolCLAS_TxHomi_1517_Tot)) %>% 
  group_by(`Bioma 1`, EvolCLAS_TxHomi_1517_Tot) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = EvolCLAS_TxHomi_1517_Tot, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )



ODS16_1_SUMARIObioma_tot <- ODS16_1_SUMARIObioma_tot[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")


ODS16_1_SUMARIObioma_tot_kbl <- kbl(ODS16_1_SUMARIObioma_tot,
                               col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 16.1: Redução da violência (2015 a 2017)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS16_1_SUMARIObioma_tot_kbl

```

#### Resumo por tipologias


```{r ODS16_1_Tabela_Tipologia_TOT, echo=FALSE, message=FALSE, warning=FALSE}


## Porcentagem de municípios 
ODS16_1_SUMARIOtipologia_tot <- ODS16_1_final %>%
  group_by(`Tipologia Veiga (2002)`, EvolCLAS_TxHomi_1517_Tot) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = EvolCLAS_TxHomi_1517_Tot, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS16_1_SUMARIOtipologia_tot <- ODS16_1_SUMARIOtipologia_tot[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS16_1_SUMARIOtipologia_tot$`Tipologia Veiga (2002)` <- factor(ODS16_1_SUMARIOtipologia_tot$`Tipologia Veiga (2002)`, levels = c("Rural", 
                                                                                                                                          "Intermediário", 
                                                                                                                                          "Urbano"))

options(knitr.kable.NA = "Não há")

ODS16_1_SUMARIOtipologia_tot_kbl <- kbl(ODS16_1_SUMARIOtipologia_tot,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 16.1: Redução da violência (2015 a 2017)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS16_1_SUMARIOtipologia_tot_kbl

```


## Critérios únicos (IBGE/IPEA) - Mulheres


**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da ONU.

* Meta ODS atingida: Decrescimento de ao menos 33% na taxa de mortalidade por homicídio intencional de 2015 para 2017 ou taxa zerada em 2017.
* Meta ODS muito próxima de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[1,]$Evol_TxHomi_1517_Fem_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_Fem_JENKS, 2)`%.
* Meta ODS próxima de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_Fem_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_Fem_JENKS, 2)`%.
* Meta ODS distante de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_Fem_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_Fem_JENKS, 2)`%.
* Meta ODS muito distante de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_Fem_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[5,]$Evol_TxHomi_1517_Fem_JENKS, 2)`%.




**Resumo por região**

```{r ODS16_1 TabelaRegiao_MULHE, echo=FALSE, message=FALSE, warning=FALSE}

#Homicídios de mulheres

options(knitr.kable.NA = "Não há")
ODS16_1_final %>%
  filter(!is.na(EvolCLAS_TxHomi_1517_Fem)) %>%
  count(REGIAO = factor(REGIAO), EvolCLAS_TxHomi_1517_Fem = factor(EvolCLAS_TxHomi_1517_Fem)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = EvolCLAS_TxHomi_1517_Fem,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 16.1: Redução da violência - Homicídios de mulheres (2015 a 2017)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))  %>%
 add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2))

```




**Distribuição espacial**

```{r ODS16_1_MAPA__MULHE, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS16_1_MAPA_fem <- 
  SHP_Mun_join_16_1 %>%
  filter(!is.na(EvolCLAS_TxHomi_1517_Fem)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "EvolCLAS_TxHomi_1517_Fem", 
         title = "ODS 16.1: Redução da violência (2015 a 2017)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
         colorNA = "light grey",
         textNA = "Não há dado disponível",
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS 16.1: Redução da violência", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  


ODS16_1_MAPA_fem


```




#### Resumo por biomas

```{r ODS16_1_Tabela_Biomas_MULHE, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 16.1 ####

ODS16_1_SUMARIObioma_fem <- ODS16_1_final %>%
  filter(!is.na(EvolCLAS_TxHomi_1517_Fem)) %>% 
  group_by(`Bioma 1`, EvolCLAS_TxHomi_1517_Fem) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = EvolCLAS_TxHomi_1517_Fem, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )



ODS16_1_SUMARIObioma_fem <- ODS16_1_SUMARIObioma_fem[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")


ODS16_1_SUMARIObioma_fem_kbl <- kbl(ODS16_1_SUMARIObioma_fem,
                               col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 16.1: Redução da violência (2015 a 2017)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS16_1_SUMARIObioma_fem_kbl

```

#### Resumo por tipologias


```{r ODS16_1_Tabela_Tipologia_MULHE, echo=FALSE, message=FALSE, warning=FALSE}


## Porcentagem de municípios 
ODS16_1_SUMARIOtipologia_fem <- ODS16_1_final %>%
  group_by(`Tipologia Veiga (2002)`, EvolCLAS_TxHomi_1517_Fem) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = EvolCLAS_TxHomi_1517_Fem, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS16_1_SUMARIOtipologia_fem <- ODS16_1_SUMARIOtipologia_fem[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS16_1_SUMARIOtipologia_fem$`Tipologia Veiga (2002)` <- factor(ODS16_1_SUMARIOtipologia_fem$`Tipologia Veiga (2002)`, levels = c("Rural", 
                                                                                                                                          "Intermediário", 
                                                                                                                                          "Urbano"))

options(knitr.kable.NA = "Não há")

ODS16_1_SUMARIOtipologia_fem_kbl <- kbl(ODS16_1_SUMARIOtipologia_fem,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 16.1: Redução da violência (2015 a 2017)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS16_1_SUMARIOtipologia_fem_kbl

```



## Critérios únicos (IBGE/IPEA) - Pretos e pardos


**Cortes**

Para determinar as cinco categorias de proximidade do cumprimento do ODS, foi utilizado a classificação de quebras naturais para os grupos que ainda não atingiram a meta da ONU.

* Meta ODS atingida: Decrescimento de ao menos 33% na taxa de mortalidade por homicídio intencional de 2015 para 2017 ou taxa zerada em 2017.
* Meta ODS muito próxima de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[1,]$Evol_TxHomi_1517_PrePar_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_PrePar_JENKS, 2)`%.
* Meta ODS próxima de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[2,]$Evol_TxHomi_1517_PrePar_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_PrePar_JENKS, 2)`%.
* Meta ODS distante de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[3,]$Evol_TxHomi_1517_PrePar_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_PrePar_JENKS, 2)`%.
* Meta ODS muito distante de ser atingida: Evolução da taxa de `r round(ODS16_1_CORTES_final[4,]$Evol_TxHomi_1517_PrePar_JENKS, 2)`% a `r round(ODS16_1_CORTES_final[5,]$Evol_TxHomi_1517_PrePar_JENKS, 2)`%.




**Resumo por região**

```{r ODS16_1 TabelaRegiao_ONU_NEGRO, echo=FALSE, message=FALSE, warning=FALSE}

#Homicídios de pessoas negras

options(knitr.kable.NA = "Não há")
ODS16_1_final %>%
  filter(!is.na(EvolCLAS_TxHomi_1517_PrePar)) %>%
  count(REGIAO = factor(REGIAO), EvolCLAS_TxHomi_1517_PrePar = factor(EvolCLAS_TxHomi_1517_PrePar)) %>% 
  group_by(REGIAO) %>%
  mutate(pct = scales::percent(prop.table(n), big.mark = ".",  decimal.mark = "," , na.rm = TRUE)) %>% 
  select(-n) %>%
  pivot_wider(names_from = EvolCLAS_TxHomi_1517_PrePar,
              values_from = pct) %>%
  kbl(align = "lccccc",
    caption = "ODS Meta 16.1: Redução da violência - Homicídios de pessoas negras (2015 a 2017)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))  %>%
 add_header_above(c(" " = 2, "Municípios próximos de atingir a meta ODS" = 2, "Municípios distantes de atingir a meta ODS" = 2))

```




**Distribuição espacial**

```{r ODS16_1_MAPA_NEGRO, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}

ODS16_1_MAPA_PP <- 
  SHP_Mun_join_16_1 %>%
  filter(!is.na(EvolCLAS_TxHomi_1517_PrePar)) %>%
  tm_shape(bbox = bbox_new) +
  tm_fill(col = "EvolCLAS_TxHomi_1517_PrePar", 
         title = "ODS 16.1: Redução da violência (2015 a 2017)", 
          id = "nome", palette=c("#003c30",
                                 "#35978f",
                                 "#c7eae5",
                                 "#dfc27d",
                                 "#8c510a"),
         colorNA = "light grey",
         textNA = "Não há dado disponível",
          style = "cat") +
  tm_shape(SHP_Estados) +
  tm_borders(lwd = 1, col = "black") +
  tm_layout(main.title = "ODS Meta 16.1: Redução da violência", main.title.position = "center", main.title.size = 1.2,
          frame = FALSE, 
          #legend.frame="white",
          legend.title.color="black",
          legend.title.size = 1,
          legend.outside = F,
          legend.position = c("left","bottom"),
          legend.format = list(text.separator = 'a', fun = function(x) paste(formatC(x,digits = 0, big.mark = ".", format = "f"), ""))) +
  
  tm_legend(position = c(0, 0.2)) + 
  tm_compass(position = c("right", "top"), 
             size = 1.5, 
             color.light = "grey90") +
  tm_scale_bar(position=c("right", "bottom"), breaks = c(0,500,1000))
  


ODS16_1_MAPA_PP


```




#### Resumo por biomas

```{r ODS16_1_Tabela_Biomas_NEGRO, echo=FALSE, message=FALSE, warning=FALSE}

#### ODS 16.1 ####

ODS16_1_SUMARIObioma_pp <- ODS16_1_final %>%
  filter(!is.na(EvolCLAS_TxHomi_1517_PrePar)) %>% 
  group_by(`Bioma 1`, EvolCLAS_TxHomi_1517_PrePar) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = EvolCLAS_TxHomi_1517_PrePar, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )



ODS16_1_SUMARIObioma_pp <- ODS16_1_SUMARIObioma_pp[,c("Bioma 1","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  

options(knitr.kable.NA = "Não há")


ODS16_1_SUMARIObioma_pp_kbl <- kbl(ODS16_1_SUMARIObioma_pp,
                               col.names = c("Bioma",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 16.1: Redução da violência (2015 a 2017)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS16_1_SUMARIObioma_pp_kbl

```

#### Resumo por tipologias


```{r ODS16_1_Tabela_Tipologia_NEGRO, echo=FALSE, message=FALSE, warning=FALSE}


## Porcentagem de municípios 
ODS16_1_SUMARIOtipologia_pp <- ODS16_1_final %>%
  group_by(`Tipologia Veiga (2002)`, EvolCLAS_TxHomi_1517_PrePar) %>%
  summarise(contagem = n()) %>%
  
  pivot_wider(names_from = EvolCLAS_TxHomi_1517_PrePar, 
              values_from = c(contagem)) %>%
  mutate(n_mun = rowSums(across(where(is.numeric)), na.rm = TRUE),
         
         pctSuperada = scales::percent((`Meta ODS atingida`/n_mun), accuracy = 0.1),
         pctMtProx = scales::percent((`Meta ODS muito próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctProx = scales::percent((`Meta ODS próxima de ser atingida`/n_mun), accuracy = 0.1),
         pctDist = scales::percent((`Meta ODS distante de ser atingida`/n_mun), accuracy = 0.1),
         pctMtDist = scales::percent((`Meta ODS muito distante de ser atingida`/n_mun), accuracy = 0.1)
         
         )

ODS16_1_SUMARIOtipologia_pp <- ODS16_1_SUMARIOtipologia_pp[,c("Tipologia Veiga (2002)","n_mun","Meta ODS atingida","pctSuperada","Meta ODS muito próxima de ser atingida","pctMtProx","Meta ODS próxima de ser atingida","pctProx","Meta ODS distante de ser atingida","pctDist","Meta ODS muito distante de ser atingida","pctMtDist")]
  
ODS16_1_SUMARIOtipologia_pp$`Tipologia Veiga (2002)` <- factor(ODS16_1_SUMARIOtipologia_pp$`Tipologia Veiga (2002)`, levels = c("Rural", 
                                                                                                                                          "Intermediário", 
                                                                                                                                          "Urbano"))

options(knitr.kable.NA = "Não há")

ODS16_1_SUMARIOtipologia_pp_kbl <- kbl(ODS16_1_SUMARIOtipologia_pp,
    col.names = c("Tipologia",
                  "Nº total de municípios",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma",
                  "Nº de municípios",
                  "% no bioma"),
    align = "ccrlrlrlrlrl",
    caption = "ODS Meta 16.1: Redução da violência (2015 a 2017)") %>%
  #kable_classic() %>%
#  kable_minimal() %>%
  #kable_material(c("striped", "hover")) 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" " = 2, "Meta ODS atingida" = 2, "Muito próximos" = 2, "Próximos" = 2, "Distantes" = 2, "Muito distantes" = 2)) %>%
  add_header_above(c(" " = 2, " " = 2, "Municípios próximos de atingir a meta ODS" = 4, "Municípios distantes de atingir a meta ODS" = 4))

ODS16_1_SUMARIOtipologia_pp_kbl

```


<br>
<br>

------

<br>
<br>



```{r exit, message=FALSE, warning=FALSE, include=FALSE}
## early exit
knitr::knit_exit()
```













